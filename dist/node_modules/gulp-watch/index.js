"use strict";function normalizeGlobs(e){if(!e)throw new PluginError("gulp-watch","glob argument required");if("string"==typeof e&&(e=[e]),!Array.isArray(e))throw new PluginError("gulp-watch","glob should be String or Array, not "+typeof e);return e}var util=require("gulp-util"),path=require("path"),PluginError=require("gulp-util").PluginError,chokidar=require("chokidar"),Duplex=require("readable-stream").Duplex,vinyl=require("vinyl-file"),File=require("vinyl"),anymatch=require("anymatch"),pathIsAbsolute=require("path-is-absolute"),glob2base=require("glob2base"),Glob=require("glob").Glob;module.exports=function(e,r,n){function i(e){var n="",i=path.resolve;return"!"===e[0]&&(n=e[0],e=e.slice(1)),r.cwd&&(i=path.normalize),n+i(e)}function a(n,i){var a=e[anymatch(e,i,!0)];return t||(r.base=glob2base(new Glob(a))),-1!==r.events.indexOf(n)?"unlink"===n||"unlinkDir"===n?(r.path=pathIsAbsolute(i)?i:path.join(r.cwd||process.cwd(),i),l(n,null,new File(r))):void setTimeout(function(){vinyl.read(i,r,l.bind(null,n))},r.readDelay):void 0}function l(e,i,a){return i?u.emit("error",i):(r.verbose&&o(e,a),a.event=e,u.push(a),void n(a))}function o(e,n){e="e"===e[e.length-1]?e+"d":e+"ed";var i=[util.colors.magenta(n.relative),"was",e];r.name&&i.unshift(util.colors.cyan(r.name)+" saw"),util.log.apply(util,i)}e=normalizeGlobs(e),"function"==typeof r&&(n=r,r={}),r=r||{},n=n||function(){},e=e.map(i),r.events=r.events||["add","change","unlink"],void 0===r.ignoreInitial&&(r.ignoreInitial=!0),r.readDelay=r.readDelay||10;var t=!!r.base,u=new Duplex({objectMode:!0,allowHalfOpen:!0});u._write=function(e,r,i){n(e),u.push(e),i()},u._read=function(){};var c=chokidar.watch(e,r).on("all",a);return["add","change","unlink","addDir","unlinkDir","error","ready","raw"].forEach(function(e){c.on(e,u.emit.bind(u,e))}),u.add=function(r){r=normalizeGlobs(r).map(i),c.add(r),e.push.apply(e,r)},u.unwatch=c.unwatch.bind(c),u.close=function(){c.close(),u.emit("end")},u};