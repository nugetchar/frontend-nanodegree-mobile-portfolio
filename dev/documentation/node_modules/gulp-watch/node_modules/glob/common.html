<!DOCTYPE html>

<html>
<head>
  <title>common.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>common.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.alphasort = alphasort
exports.alphasorti = alphasorti
exports.setopts = setopts
exports.ownProp = ownProp
exports.makeAbs = makeAbs
exports.finish = finish
exports.mark = mark
exports.isIgnored = isIgnored
exports.childrenIgnored = childrenIgnored

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ownProp</span> (<span class="hljs-params">obj, field</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(obj, field)
}

<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)
<span class="hljs-keyword">var</span> minimatch = <span class="hljs-built_in">require</span>(<span class="hljs-string">"minimatch"</span>)
<span class="hljs-keyword">var</span> isAbsolute = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path-is-absolute"</span>)
<span class="hljs-keyword">var</span> Minimatch = minimatch.Minimatch

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">alphasorti</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">return</span> a.toLowerCase().localeCompare(b.toLowerCase())
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">alphasort</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">return</span> a.localeCompare(b)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupIgnores</span> (<span class="hljs-params">self, options</span>) </span>{
  self.ignore = options.ignore || []

  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(self.ignore))
    self.ignore = [self.ignore]

  <span class="hljs-keyword">if</span> (self.ignore.length) {
    self.ignore = self.ignore.map(ignoreMap)
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ignoreMap</span> (<span class="hljs-params">pattern</span>) </span>{
  <span class="hljs-keyword">var</span> gmatcher = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (pattern.slice(-<span class="hljs-number">3</span>) === <span class="hljs-string">'/**'</span>) {
    <span class="hljs-keyword">var</span> gpattern = pattern.replace(<span class="hljs-regexp">/(\/\*\*)+$/</span>, <span class="hljs-string">''</span>)
    gmatcher = <span class="hljs-keyword">new</span> Minimatch(gpattern)
  }

  <span class="hljs-keyword">return</span> {
    matcher: <span class="hljs-keyword">new</span> Minimatch(pattern),
    gmatcher: gmatcher
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setopts</span> (<span class="hljs-params">self, pattern, options</span>) </span>{
  <span class="hljs-keyword">if</span> (!options)
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>base-matching: just use globstar for that.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (options.matchBase &amp;&amp; -<span class="hljs-number">1</span> === pattern.indexOf(<span class="hljs-string">"/"</span>)) {
    <span class="hljs-keyword">if</span> (options.noglobstar) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"base matching requires globstar"</span>)
    }
    pattern = <span class="hljs-string">"**/"</span> + pattern
  }

  self.silent = !!options.silent
  self.pattern = pattern
  self.strict = options.strict !== <span class="hljs-literal">false</span>
  self.realpath = !!options.realpath
  self.realpathCache = options.realpathCache || <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)
  self.follow = !!options.follow
  self.dot = !!options.dot
  self.mark = !!options.mark
  self.nodir = !!options.nodir
  <span class="hljs-keyword">if</span> (self.nodir)
    self.mark = <span class="hljs-literal">true</span>
  self.sync = !!options.sync
  self.nounique = !!options.nounique
  self.nonull = !!options.nonull
  self.nosort = !!options.nosort
  self.nocase = !!options.nocase
  self.stat = !!options.stat
  self.noprocess = !!options.noprocess

  self.maxLength = options.maxLength || <span class="hljs-literal">Infinity</span>
  self.cache = options.cache || <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)
  self.statCache = options.statCache || <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)
  self.symlinks = options.symlinks || <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)

  setupIgnores(self, options)

  self.changedCwd = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">var</span> cwd = process.cwd()
  <span class="hljs-keyword">if</span> (!ownProp(options, <span class="hljs-string">"cwd"</span>))
    self.cwd = cwd
  <span class="hljs-keyword">else</span> {
    self.cwd = options.cwd
    self.changedCwd = path.resolve(options.cwd) !== cwd
  }

  self.root = options.root || path.resolve(self.cwd, <span class="hljs-string">"/"</span>)
  self.root = path.resolve(self.root)
  <span class="hljs-keyword">if</span> (process.platform === <span class="hljs-string">"win32"</span>)
    self.root = self.root.replace(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">"/"</span>)

  self.nomount = !!options.nomount</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>disable comments and negation unless the user explicitly
passes in false as the option.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.nonegate = options.nonegate === <span class="hljs-literal">false</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>
  options.nocomment = options.nocomment === <span class="hljs-literal">false</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>
  deprecationWarning(options)

  self.minimatch = <span class="hljs-keyword">new</span> Minimatch(pattern, options)
  self.options = self.minimatch.options
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>TODO(isaacs): remove entirely in v6
exported to reset in tests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.deprecationWarned
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deprecationWarning</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">if</span> (!options.nonegate || !options.nocomment) {
    <span class="hljs-keyword">if</span> (process.noDeprecation !== <span class="hljs-literal">true</span> &amp;&amp; !exports.deprecationWarned) {
      <span class="hljs-keyword">var</span> msg = <span class="hljs-string">'glob WARNING: comments and negation will be disabled in v6'</span>
      <span class="hljs-keyword">if</span> (process.throwDeprecation)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(msg)
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.traceDeprecation)
        <span class="hljs-built_in">console</span>.trace(msg)
      <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">console</span>.error(msg)

      exports.deprecationWarned = <span class="hljs-literal">true</span>
    }
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finish</span> (<span class="hljs-params">self</span>) </span>{
  <span class="hljs-keyword">var</span> nou = self.nounique
  <span class="hljs-keyword">var</span> all = nou ? [] : <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = self.matches.length; i &lt; l; i ++) {
    <span class="hljs-keyword">var</span> matches = self.matches[i]
    <span class="hljs-keyword">if</span> (!matches || <span class="hljs-built_in">Object</span>.keys(matches).length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (self.nonull) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>do like the shell, and spit out the literal glob</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> literal = self.minimatch.globSet[i]
        <span class="hljs-keyword">if</span> (nou)
          all.push(literal)
        <span class="hljs-keyword">else</span>
          all[literal] = <span class="hljs-literal">true</span>
      }
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>had matches</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> m = <span class="hljs-built_in">Object</span>.keys(matches)
      <span class="hljs-keyword">if</span> (nou)
        all.push.apply(all, m)
      <span class="hljs-keyword">else</span>
        m.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m</span>) </span>{
          all[m] = <span class="hljs-literal">true</span>
        })
    }
  }

  <span class="hljs-keyword">if</span> (!nou)
    all = <span class="hljs-built_in">Object</span>.keys(all)

  <span class="hljs-keyword">if</span> (!self.nosort)
    all = all.sort(self.nocase ? alphasorti : alphasort)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>at <em>some</em> point we statted all of these</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (self.mark) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; all.length; i++) {
      all[i] = self._mark(all[i])
    }
    <span class="hljs-keyword">if</span> (self.nodir) {
      all = all.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">return</span> !(<span class="hljs-regexp">/\/$/</span>.test(e))
      })
    }
  }

  <span class="hljs-keyword">if</span> (self.ignore.length)
    all = all.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m</span>) </span>{
      <span class="hljs-keyword">return</span> !isIgnored(self, m)
    })

  self.found = all
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mark</span> (<span class="hljs-params">self, p</span>) </span>{
  <span class="hljs-keyword">var</span> abs = makeAbs(self, p)
  <span class="hljs-keyword">var</span> c = self.cache[abs]
  <span class="hljs-keyword">var</span> m = p
  <span class="hljs-keyword">if</span> (c) {
    <span class="hljs-keyword">var</span> isDir = c === <span class="hljs-string">'DIR'</span> || <span class="hljs-built_in">Array</span>.isArray(c)
    <span class="hljs-keyword">var</span> slash = p.slice(-<span class="hljs-number">1</span>) === <span class="hljs-string">'/'</span>

    <span class="hljs-keyword">if</span> (isDir &amp;&amp; !slash)
      m += <span class="hljs-string">'/'</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isDir &amp;&amp; slash)
      m = m.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)

    <span class="hljs-keyword">if</span> (m !== p) {
      <span class="hljs-keyword">var</span> mabs = makeAbs(self, m)
      self.statCache[mabs] = self.statCache[abs]
      self.cache[mabs] = self.cache[abs]
    }
  }

  <span class="hljs-keyword">return</span> m
}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>lotta situps…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeAbs</span> (<span class="hljs-params">self, f</span>) </span>{
  <span class="hljs-keyword">var</span> abs = f
  <span class="hljs-keyword">if</span> (f.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'/'</span>) {
    abs = path.join(self.root, f)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isAbsolute(f) || f === <span class="hljs-string">''</span>) {
    abs = f
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.changedCwd) {
    abs = path.resolve(self.cwd, f)
  } <span class="hljs-keyword">else</span> {
    abs = path.resolve(f)
  }
  <span class="hljs-keyword">return</span> abs
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Return true, if pattern ends with globstar ‘<strong>‘, for the accompanying parent directory.
Ex:- If node_modules/</strong> is the pattern, add ‘node_modules’ to ignore list along with it’s contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isIgnored</span> (<span class="hljs-params">self, path</span>) </span>{
  <span class="hljs-keyword">if</span> (!self.ignore.length)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> self.ignore.some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
    <span class="hljs-keyword">return</span> item.matcher.match(path) || !!(item.gmatcher &amp;&amp; item.gmatcher.match(path))
  })
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">childrenIgnored</span> (<span class="hljs-params">self, path</span>) </span>{
  <span class="hljs-keyword">if</span> (!self.ignore.length)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> self.ignore.some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
    <span class="hljs-keyword">return</span> !!(item.gmatcher &amp;&amp; item.gmatcher.match(path))
  })
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
