<!DOCTYPE html>

<html>
<head>
  <title>docco.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>docco.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Generated by CoffeeScript 1.7.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> Docco, buildMatchers, commander, configure, defaults, <span class="hljs-built_in">document</span>, format, fs, getLanguage, highlightjs, languages, marked, parse, path, run, version, write, _,
    __slice = [].slice;

  <span class="hljs-built_in">document</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options, callback</span>) </span>{
    <span class="hljs-keyword">var</span> config;
    <span class="hljs-keyword">if</span> (options == <span class="hljs-literal">null</span>) {
      options = {};
    }
    config = configure(options);
    <span class="hljs-keyword">return</span> fs.mkdirs(config.output, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> complete, copyAsset, files, nextFile;
      callback || (callback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-keyword">if</span> (error) {
          <span class="hljs-keyword">throw</span> error;
        }
      });
      copyAsset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file, callback</span>) </span>{
        <span class="hljs-keyword">return</span> fs.copy(file, path.join(config.output, path.basename(file)), callback);
      };
      complete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> copyAsset(config.css, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
          <span class="hljs-keyword">if</span> (error) {
            <span class="hljs-keyword">return</span> callback(error);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fs.existsSync(config[<span class="hljs-string">"public"</span>])) {
            <span class="hljs-keyword">return</span> copyAsset(config[<span class="hljs-string">"public"</span>], callback);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> callback();
          }
        });
      };
      files = config.sources.slice();
      nextFile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> source;
        source = files.shift();
        <span class="hljs-keyword">return</span> fs.readFile(source, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, buffer</span>) </span>{
          <span class="hljs-keyword">var</span> code, sections;
          <span class="hljs-keyword">if</span> (error) {
            <span class="hljs-keyword">return</span> callback(error);
          }
          code = buffer.toString();
          sections = parse(source, code, config);
          format(source, sections, config);
          write(source, sections, config);
          <span class="hljs-keyword">if</span> (files.length) {
            <span class="hljs-keyword">return</span> nextFile();
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> complete();
          }
        });
      };
      <span class="hljs-keyword">return</span> nextFile();
    });
  };

  parse = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, code, config</span>) </span>{
    <span class="hljs-keyword">var</span> codeText, docsText, hasCode, i, isText, lang, line, lines, match, maybeCode, save, sections, _i, _j, _len, _len1;
    <span class="hljs-keyword">if</span> (config == <span class="hljs-literal">null</span>) {
      config = {};
    }
    lines = code.split(<span class="hljs-string">'\n'</span>);
    sections = [];
    lang = getLanguage(source, config);
    hasCode = docsText = codeText = <span class="hljs-string">''</span>;
    save = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      sections.push({
        docsText: docsText,
        codeText: codeText
      });
      <span class="hljs-keyword">return</span> hasCode = docsText = codeText = <span class="hljs-string">''</span>;
    };
    <span class="hljs-keyword">if</span> (lang.literate) {
      isText = maybeCode = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">for</span> (i = _i = <span class="hljs-number">0</span>, _len = lines.length; _i &lt; _len; i = ++_i) {
        line = lines[i];
        lines[i] = maybeCode &amp;&amp; (match = <span class="hljs-regexp">/^([ ]{4}|[ ]{0,3}\t)/</span>.exec(line)) ? (isText = <span class="hljs-literal">false</span>, line.slice(match[<span class="hljs-number">0</span>].length)) : (maybeCode = <span class="hljs-regexp">/^\s*$/</span>.test(line)) ? isText ? lang.symbol : <span class="hljs-string">''</span> : (isText = <span class="hljs-literal">true</span>, lang.symbol + <span class="hljs-string">' '</span> + line);
      }
    }
    <span class="hljs-keyword">for</span> (_j = <span class="hljs-number">0</span>, _len1 = lines.length; _j &lt; _len1; _j++) {
      line = lines[_j];
      <span class="hljs-keyword">if</span> (line.match(lang.commentMatcher) &amp;&amp; !line.match(lang.commentFilter)) {
        <span class="hljs-keyword">if</span> (hasCode) {
          save();
        }
        docsText += (line = line.replace(lang.commentMatcher, <span class="hljs-string">''</span>)) + <span class="hljs-string">'\n'</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(---+|===+)$/</span>.test(line)) {
          save();
        }
      } <span class="hljs-keyword">else</span> {
        hasCode = <span class="hljs-literal">true</span>;
        codeText += line + <span class="hljs-string">'\n'</span>;
      }
    }
    save();
    <span class="hljs-keyword">return</span> sections;
  };

  format = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, sections, config</span>) </span>{
    <span class="hljs-keyword">var</span> code, i, language, section, _i, _len, _results;
    language = getLanguage(source, config);
    marked.setOptions({
      highlight: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">code, lang</span>) </span>{
        lang || (lang = language.name);
        <span class="hljs-keyword">if</span> (highlightjs.getLanguage(lang)) {
          <span class="hljs-keyword">return</span> highlightjs.highlight(lang, code).value;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"docco: couldn't highlight code block with unknown language '"</span> + lang + <span class="hljs-string">"' in "</span> + source);
          <span class="hljs-keyword">return</span> code;
        }
      }
    });
    _results = [];
    <span class="hljs-keyword">for</span> (i = _i = <span class="hljs-number">0</span>, _len = sections.length; _i &lt; _len; i = ++_i) {
      section = sections[i];
      code = highlightjs.highlight(language.name, section.codeText).value;
      code = code.replace(<span class="hljs-regexp">/\s+$/</span>, <span class="hljs-string">''</span>);
      section.codeHtml = <span class="hljs-string">"&lt;div class='highlight'&gt;&lt;pre&gt;"</span> + code + <span class="hljs-string">"&lt;/pre&gt;&lt;/div&gt;"</span>;
      _results.push(section.docsHtml = marked(section.docsText));
    }
    <span class="hljs-keyword">return</span> _results;
  };

  write = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, sections, config</span>) </span>{
    <span class="hljs-keyword">var</span> destination, first, hasTitle, html, title;
    destination = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
      <span class="hljs-keyword">return</span> path.join(config.output, path.basename(file, path.extname(file)) + <span class="hljs-string">'.html'</span>);
    };
    first = marked.lexer(sections[<span class="hljs-number">0</span>].docsText)[<span class="hljs-number">0</span>];
    hasTitle = first &amp;&amp; first.type === <span class="hljs-string">'heading'</span> &amp;&amp; first.depth === <span class="hljs-number">1</span>;
    title = hasTitle ? first.text : path.basename(source);
    html = config.template({
      sources: config.sources,
      css: path.basename(config.css),
      title: title,
      hasTitle: hasTitle,
      sections: sections,
      path: path,
      destination: destination
    });
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"docco: "</span> + source + <span class="hljs-string">" -&gt; "</span> + (destination(source)));
    <span class="hljs-keyword">return</span> fs.writeFileSync(destination(source), html);
  };

  defaults = {
    layout: <span class="hljs-string">'parallel'</span>,
    output: <span class="hljs-string">'docs'</span>,
    template: <span class="hljs-literal">null</span>,
    css: <span class="hljs-literal">null</span>,
    extension: <span class="hljs-literal">null</span>,
    languages: {}
  };

  configure = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
    <span class="hljs-keyword">var</span> config, dir;
    config = _.extend({}, defaults, _.pick.apply(_, [options].concat(__slice.call(_.keys(defaults)))));
    config.languages = buildMatchers(config.languages);
    <span class="hljs-keyword">if</span> (options.template) {
      config.layout = <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">else</span> {
      dir = config.layout = path.join(__dirname, <span class="hljs-string">'resources'</span>, config.layout);
      <span class="hljs-keyword">if</span> (fs.existsSync(path.join(dir, <span class="hljs-string">'public'</span>))) {
        config[<span class="hljs-string">"public"</span>] = path.join(dir, <span class="hljs-string">'public'</span>);
      }
      config.template = path.join(dir, <span class="hljs-string">'docco.jst'</span>);
      config.css = options.css || path.join(dir, <span class="hljs-string">'docco.css'</span>);
    }
    config.template = _.template(fs.readFileSync(config.template).toString());
    config.sources = options.args.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) </span>{
      <span class="hljs-keyword">var</span> lang;
      lang = getLanguage(source, config);
      <span class="hljs-keyword">if</span> (!lang) {
        <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"docco: skipped unknown type ("</span> + (path.basename(source)) + <span class="hljs-string">")"</span>);
      }
      <span class="hljs-keyword">return</span> lang;
    }).sort();
    <span class="hljs-keyword">return</span> config;
  };

  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);

  fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);

  path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

  marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);

  commander = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);

  highlightjs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);

  marked.setOptions({
    smartypants: <span class="hljs-literal">true</span>
  });

  languages = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(path.join(__dirname, <span class="hljs-string">'resources'</span>, <span class="hljs-string">'languages.json'</span>)));

  buildMatchers = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">languages</span>) </span>{
    <span class="hljs-keyword">var</span> ext, l;
    <span class="hljs-keyword">for</span> (ext <span class="hljs-keyword">in</span> languages) {
      l = languages[ext];
      l.commentMatcher = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"^\\s*"</span> + l.symbol + <span class="hljs-string">"\\s?"</span>);
      l.commentFilter = <span class="hljs-regexp">/(^#![/]|^\s*#\{)/</span>;
    }
    <span class="hljs-keyword">return</span> languages;
  };

  languages = buildMatchers(languages);

  getLanguage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, config</span>) </span>{
    <span class="hljs-keyword">var</span> codeExt, codeLang, ext, lang;
    ext = config.extension || path.extname(source) || path.basename(source);
    lang = config.languages[ext] || languages[ext];
    <span class="hljs-keyword">if</span> (lang &amp;&amp; lang.name === <span class="hljs-string">'markdown'</span>) {
      codeExt = path.extname(path.basename(source, ext));
      <span class="hljs-keyword">if</span> (codeExt &amp;&amp; (codeLang = languages[codeExt])) {
        lang = _.extend({}, codeLang, {
          literate: <span class="hljs-literal">true</span>
        });
      }
    }
    <span class="hljs-keyword">return</span> lang;
  };

  version = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(path.join(__dirname, <span class="hljs-string">'package.json'</span>))).version;

  run = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> c;
    <span class="hljs-keyword">if</span> (args == <span class="hljs-literal">null</span>) {
      args = process.argv;
    }
    c = defaults;
    commander.version(version).usage(<span class="hljs-string">'[options] files'</span>).option(<span class="hljs-string">'-L, --languages [file]'</span>, <span class="hljs-string">'use a custom languages.json'</span>, _.compose(<span class="hljs-built_in">JSON</span>.parse, fs.readFileSync)).option(<span class="hljs-string">'-l, --layout [name]'</span>, <span class="hljs-string">'choose a layout (parallel, linear or classic)'</span>, c.layout).option(<span class="hljs-string">'-o, --output [path]'</span>, <span class="hljs-string">'output to a given folder'</span>, c.output).option(<span class="hljs-string">'-c, --css [file]'</span>, <span class="hljs-string">'use a custom css file'</span>, c.css).option(<span class="hljs-string">'-t, --template [file]'</span>, <span class="hljs-string">'use a custom .jst template'</span>, c.template).option(<span class="hljs-string">'-e, --extension [ext]'</span>, <span class="hljs-string">'assume a file extension for all inputs'</span>, c.extension).parse(args).name = <span class="hljs-string">"docco"</span>;
    <span class="hljs-keyword">if</span> (commander.args.length) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>(commander);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(commander.helpInformation());
    }
  };

  Docco = <span class="hljs-built_in">module</span>.exports = {
    run: run,
    <span class="hljs-built_in">document</span>: <span class="hljs-built_in">document</span>,
    parse: parse,
    format: format,
    version: version
  };

}).call(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
