<!DOCTYPE html>

<html>
<head>
  <title>Gruntfile.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Gruntfile.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;
<span class="hljs-comment">/**
 * @fileOverview Gruntfile tasks. These tasks are intended to help you when modifying the template. If you are
 * just using the template, don't sweat this stuff. To use these tasks, you must install grunt, if you haven't already,
 * and install the dependencies. All of this requires node.js, of course.
 *
 * Install grunt:
 *
 *      npm install -g grunt-cli
 *
 * Then in the directory where you found this file:
 *
 *      npm install
 *
 * And you are all set. See the individual tasks for details.
 *
 * @module Gruntfile
 * @requires path
 * @requires lodash
 * @requires http
 * @requires async
 * @requires fs
 */</span>
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>( <span class="hljs-string">"path"</span> );
<span class="hljs-keyword">var</span> sys = <span class="hljs-built_in">require</span>( <span class="hljs-string">"lodash"</span> );
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>( <span class="hljs-string">"http"</span> );
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">require</span>( <span class="hljs-string">"async"</span> );
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>( <span class="hljs-string">"fs"</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>this rather odd arrangement of composing tasks like this to make sure this works on both
windows and linux correctly. We canâ€™t depend on Grunt or Node to normalize
paths for us because we shell out to make this work. So we gather up
our relative paths here, normalize them later and then pass them into
the shell to be run by JSDoc3.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
 * The definition to run the development test files. This runs the files in `fixtures` with the
 * project's `conf.json` file.
 * @private
 */</span>
<span class="hljs-keyword">var</span> jsdocTestPages = {
	src       : [<span class="hljs-string">"./fixtures/*.js"</span>, <span class="hljs-string">"./README.md"</span>],
	dest      : <span class="hljs-string">"./testdocs"</span>,
	tutorials : <span class="hljs-string">"./fixtures/tutorials"</span>,
	template  : <span class="hljs-string">"./template"</span>,
	config    : <span class="hljs-string">"./template/jsdoc.conf.json"</span>,
	options   : <span class="hljs-string">" --lenient --verbose"</span>
};
<span class="hljs-comment">/**
 * The definition to run the sample files. This runs the files in `fixtures` with the
 * sample's `conf.json` file. No task directly exposes this configuration. The `fixtures` task
 * modifies this for each swatch it finds and then run the docs command against it.
 * @private
 */</span>
<span class="hljs-keyword">var</span> jsdocExamplePages = {
	src       : [<span class="hljs-string">"./fixtures/*.js"</span>, <span class="hljs-string">"./README.md"</span>],
	dest      : <span class="hljs-string">"./themes"</span>,
	tutorials : <span class="hljs-string">""</span>,
	template  : <span class="hljs-string">"./template"</span>,
	config    : <span class="hljs-string">"./fixtures/example.conf.json"</span>,
	options   : <span class="hljs-string">" --lenient --verbose --recurse"</span>
};

<span class="hljs-comment">/**
 * This definition provides the project's main, published documentation.
 *  @private
 */</span>
<span class="hljs-keyword">var</span> projectDocs = {
	src       : [<span class="hljs-string">"./Gruntfile*.js"</span>, <span class="hljs-string">"./README.md"</span>, <span class="hljs-string">"./template/publish.js"</span>],
	dest      : <span class="hljs-string">"./dox"</span>,
	tutorials : <span class="hljs-string">""</span>,
	template  : <span class="hljs-string">"./template"</span>,
	config    : <span class="hljs-string">"./template/jsdoc.conf.json"</span>,
	options   : <span class="hljs-string">" --lenient --verbose --recurse --private"</span>
};

<span class="hljs-comment">/**
 * Normalizes all paths from a JSDoc task definition and and returns an executable string that can be passed to the shell.
 * @param {object} jsdoc A JSDoc definition
 * @returns {string}
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsdocCommand</span>(<span class="hljs-params"> jsdoc </span>) </span>{
	<span class="hljs-keyword">var</span> cmd = [];
	cmd.unshift( jsdoc.options );
	<span class="hljs-keyword">if</span> ( jsdoc.tutorials.length &gt; <span class="hljs-number">0</span> ) {
		cmd.push( <span class="hljs-string">"-u "</span> + path.resolve( jsdoc.tutorials ) );
	}
	cmd.push( <span class="hljs-string">"-d "</span> + path.resolve( jsdoc.dest ) );
	cmd.push( <span class="hljs-string">"-t "</span> + path.resolve( jsdoc.template ) );
	cmd.push( <span class="hljs-string">"-c "</span> + path.resolve( jsdoc.config ) );
	sys.each( jsdoc.src, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> src </span>) </span>{
		cmd.push( path.resolve( src ) );
	} );
	cmd.unshift( path.resolve( <span class="hljs-string">"./node_modules/jsdoc/jsdoc"</span> ) );
	<span class="hljs-keyword">return</span> cmd.join( <span class="hljs-string">" "</span> );
}

<span class="hljs-keyword">var</span> tasks = {
	shell : {
		options  : {
			stdout : <span class="hljs-literal">true</span>,
			stderr : <span class="hljs-literal">true</span>
		},
		<span class="hljs-comment">/**
		 * TASK: Create the a documentation set for testing changes to the template
		 * @name shell:testdocs
		 * @memberOf module:Gruntfile
		 */</span>
		testdocs : {
			command : jsdocCommand( jsdocTestPages )
		},
		<span class="hljs-comment">/**
		 * TASK: Create project documentation
		 * @name shell:dox
		 * @memberOf module:Gruntfile
		 */</span>
		dox      : {
			command : jsdocCommand( projectDocs )
		}
	},
	<span class="hljs-comment">/**
	 * TASK: The less task creates the themed css file from main.less. The file is written to the template styles
	 * directory as site.[name of theme].css. Later the .conf file will look for the theme to apply based
	 * on this naming convention.
	 * @name less
	 * @memberOf module:Gruntfile
	 */</span>
	less  : {
		dev : {
			files : {
				<span class="hljs-string">"template/static/styles/site.&lt;%= jsdocConf.templates.theme %&gt;.css"</span> : <span class="hljs-string">"styles/main.less"</span>
			}
		}
	},
	copy   : {
		docs : {
			files : [
				{expand : <span class="hljs-literal">true</span>, cwd : <span class="hljs-string">"dox/"</span>, src : [<span class="hljs-string">'**'</span>], dest : <span class="hljs-string">'../docstrap-dox/'</span>},
				{expand : <span class="hljs-literal">true</span>, cwd : <span class="hljs-string">"themes/"</span>, src : [<span class="hljs-string">'**'</span>], dest : <span class="hljs-string">'../docstrap-dox/themes'</span>}
			]
		}
	}
};

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> grunt </span>) </span>{
	tasks.jsdocConf = grunt.file.readJSON( <span class="hljs-string">'template/jsdoc.conf.json'</span> );
	grunt.initConfig( tasks );

	grunt.loadNpmTasks( <span class="hljs-string">'grunt-contrib-less'</span> );
	grunt.loadNpmTasks( <span class="hljs-string">'grunt-shell'</span> );
	grunt.loadNpmTasks( <span class="hljs-string">'grunt-contrib-copy'</span> );

	grunt.registerTask( <span class="hljs-string">"default"</span>, [<span class="hljs-string">"docs"</span>] );

	<span class="hljs-comment">/**
	 * Builds the project's documentation
	 * @name docs
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"docs"</span>, <span class="hljs-string">"Create the project documentation"</span>, [<span class="hljs-string">"shell:dox"</span>] );
	<span class="hljs-comment">/**
	 * Compile the CSS and create the project documentation
	 * @name dev
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"dev"</span>, <span class="hljs-string">"Compile the CSS and create the project documentation"</span>, [<span class="hljs-string">"less"</span>,<span class="hljs-string">"shell:dox"</span>] );
	<span class="hljs-comment">/**
	 * TASK: Builds the main less file and then generates the test documents
	 * @name testdocs
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"testdocs"</span>, <span class="hljs-string">"Builds the main less file and then generates the test documents"</span>, [<span class="hljs-string">"less:dev"</span>, <span class="hljs-string">"shell:testdocs"</span>] );
	<span class="hljs-comment">/**
	 * TASK: Builds the whole shebang. Which means creating testdocs, the bootswatch fixtures and then resetting the
	 * styles directory.
	 * @name build
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"build"</span>, <span class="hljs-string">"Builds the whole shebang. Which means creating testdocs, the bootswatch samples and then resetting the styles directory"</span>, [<span class="hljs-string">"testdocs"</span>, <span class="hljs-string">"shell:dox"</span>, <span class="hljs-string">"bootswatch"</span>, <span class="hljs-string">"examples"</span>, <span class="hljs-string">"apply"</span>, <span class="hljs-string">"copy"</span>] );
	<span class="hljs-comment">/**
	 * TASK: Applies the theme in the conf file and applies it to the styles directory.
	 * @name apply
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"apply"</span>, <span class="hljs-string">"Applies the theme in the conf file and applies it to the styles directory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> def = {
			less          : <span class="hljs-string">"http://bootswatch.com/"</span> + tasks.jsdocConf.templates.theme + <span class="hljs-string">"/bootswatch.less"</span>,
			lessVariables : <span class="hljs-string">"http://bootswatch.com/"</span> + tasks.jsdocConf.templates.theme + <span class="hljs-string">"/variables.less"</span>
		};
		grunt.registerTask( <span class="hljs-string">"swatch-apply"</span>, sys.partial( applyTheme, grunt, def ) );
		grunt.task.run( [<span class="hljs-string">"swatch-apply"</span>] );
	} );
	<span class="hljs-comment">/**
	 * TASK: Grab all Bootswatch themes and create css from each one based on the main.less in the styles directory. NOTE that this will
	 * leave the last swatch downloaded in the styles directory, you will want to call "apply" afterwards
	 * @name bootswatch
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"bootswatch"</span>, <span class="hljs-string">"Grab all Bootswatch themes and create css from each one based on the main.less in the styles directory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> toRun = [];

		<span class="hljs-keyword">var</span> done = <span class="hljs-keyword">this</span>.async();
		getBootSwatchList( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> err, list </span>) </span>{
			<span class="hljs-keyword">if</span> ( err ) {<span class="hljs-keyword">return</span> done( err );}

			sys.each( list.themes, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> entry </span>) </span>{

				toRun.push( <span class="hljs-string">"swatch"</span> + entry.name );
				grunt.registerTask( <span class="hljs-string">"swatch"</span> + entry.name, sys.partial( applyTheme, grunt, entry ) );

				<span class="hljs-keyword">var</span> key = <span class="hljs-string">"template/static/styles/site."</span> + entry.name.toLowerCase() + <span class="hljs-string">".css"</span>;
				<span class="hljs-keyword">var</span> def = {};
				def[key] = <span class="hljs-string">"styles/main.less"</span>;
				tasks.less[<span class="hljs-string">"swatch"</span> + entry.name] = {
					files : def
				};
				toRun.push( <span class="hljs-string">"less:swatch"</span> + entry.name );
			} );
			grunt.task.run( toRun );
			done();
		} );

	} );
	<span class="hljs-comment">/**
	 * TASK:Create fixtures from the themes. The files must have been built first from the bootswatch task.
	 * @name examples
	 * @memberof module:Gruntfile
	 */</span>
	grunt.registerTask( <span class="hljs-string">"examples"</span>, <span class="hljs-string">"Create samples from the themes"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> toRun = [];
		<span class="hljs-keyword">var</span> done = <span class="hljs-keyword">this</span>.async();
		getBootSwatchList( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> err, list </span>) </span>{
			<span class="hljs-keyword">if</span> ( err ) {<span class="hljs-keyword">return</span> done( err );}

			sys.each( list.themes, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> entry </span>) </span>{
				<span class="hljs-keyword">var</span> conf = grunt.file.readJSON( <span class="hljs-string">'./fixtures/example.conf.json'</span> );
				conf.templates.theme = entry.name.toLowerCase();
				grunt.file.write( <span class="hljs-string">"tmp/example.conf."</span> + conf.templates.theme + <span class="hljs-string">".json"</span>, <span class="hljs-built_in">JSON</span>.stringify( conf, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span> ) );

				<span class="hljs-keyword">var</span> jsdenv = sys.cloneDeep( jsdocExamplePages );
				jsdenv.config = <span class="hljs-string">"./tmp/example.conf."</span> + conf.templates.theme + <span class="hljs-string">".json"</span>;
				jsdenv.dest = <span class="hljs-string">"./themes/"</span> + conf.templates.theme;
				tasks.shell[<span class="hljs-string">"example"</span> + conf.templates.theme] = {
					command : jsdocCommand( jsdenv )
				};
				toRun.push( <span class="hljs-string">"shell:example"</span> + conf.templates.theme );
			} );

			grunt.registerTask( <span class="hljs-string">"cleanup"</span>, <span class="hljs-string">""</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				grunt.file[<span class="hljs-string">"delete"</span>]( <span class="hljs-string">"tmp/"</span> );
			} );
			toRun.push( <span class="hljs-string">"cleanup"</span> );
			grunt.task.run( toRun );
			done();
		} );

	} );
};

<span class="hljs-comment">/**
 * Applies one of the Bootswatch themes to the working `styles` directory. When you want to modify a particular theme, this where you
 * get the basis for it. The files are written to `./styles/variables.less` and `./styles/bootswatch.less`. The `./styles/main.less`
 * file includes them directly, so after you apply the theme, modify `main.less` to your heart's content and then run the `less` task
 * as in
 *
 *      grunt less
 *
 * @param {object} grunt The grunt object reference
 * @param {object} definition The swatch definition files
 * @param {string} definition.less The url to the `bootswatch.less` file
 * @param {string} definition.lessVariables The url to the `variables.less` file
 * @private
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyTheme</span>(<span class="hljs-params"> grunt, definition </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>noinspection JSHint</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> done = <span class="hljs-keyword">this</span>.async();
	<span class="hljs-keyword">async</span>.waterfall( [
		<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> cb </span>) </span>{
			getBootSwatchComponent( definition.less, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> err, swatch </span>) </span>{
				<span class="hljs-keyword">if</span> ( err ) {<span class="hljs-keyword">return</span> cb( err );}
				<span class="hljs-keyword">var</span> fullPath = path.join( __dirname, <span class="hljs-string">"styles/bootswatch.less"</span> );
				fs.writeFile( fullPath, swatch.replace(<span class="hljs-string">"http://"</span>, <span class="hljs-string">"//"</span>), cb );
			} );
		},
		<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> cb </span>) </span>{
			getBootSwatchComponent( definition.lessVariables, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> err, swatch </span>) </span>{
				<span class="hljs-keyword">if</span> ( err ) {<span class="hljs-keyword">return</span> cb( err );}
				<span class="hljs-keyword">var</span> fullPath = path.join( __dirname, <span class="hljs-string">"styles/variables.less"</span> );
				fs.writeFile( fullPath, swatch.replace(<span class="hljs-string">"http://"</span>, <span class="hljs-string">"//"</span>), cb );
			} );
		}
	], done );
}

<span class="hljs-comment">/**
 * Gets the list of available Bootswatches from, well, Bootswatch.
 *
 * @see http://news.bootswatch.com/post/22193315172/bootswatch-api
 * @param {function(err, responseBody)} done The callback when complete
 * @param {?object} done.err If an error occurred, you will find it here.
 * @param {object} done.responseBody This is a parsed edition of the bootswatch server's response. It's format it defined
 * by the return message from [here](http://api.bootswatch.com/)
 * @private
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBootSwatchList</span>(<span class="hljs-params"> done </span>) </span>{
	<span class="hljs-keyword">var</span> options = {
		hostname : <span class="hljs-string">'api.bootswatch.com'</span>,
		port     : <span class="hljs-number">80</span>,
		path     : <span class="hljs-string">'/'</span>,
		method   : <span class="hljs-string">'GET'</span>
	};
	<span class="hljs-keyword">var</span> body = <span class="hljs-string">""</span>;
	<span class="hljs-keyword">var</span> req = http.request( options, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> res </span>) </span>{
		res.setEncoding( <span class="hljs-string">'utf8'</span> );
		res.on( <span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> chunk </span>) </span>{
			body += chunk;
		} );

		res.on( <span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			done( <span class="hljs-literal">null</span>, <span class="hljs-built_in">JSON</span>.parse( body ) );
		} );
		res.on( <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>) </span>{
			done( <span class="hljs-string">'problem with response: '</span> + e.message );
		} );
	} );

	req.on( <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>) </span>{
		done( <span class="hljs-string">'problem with request: '</span> + e.message );
	} );
	req.end();
}

<span class="hljs-comment">/**
 * This method will get one of the components from Bootswatch, which is generally a `less` file or a `lessVariables` file.
 *
 * @see http://news.bootswatch.com/post/22193315172/bootswatch-api
 * @param {string} url The url to retreive from
 * @param {function(err, responseText)} done The callback when complete
 * @param {?object} done.err If an error occurred, you will find it here.
 * @param {string} done.responseText The body of whatever was returned
 * @private
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBootSwatchComponent</span>(<span class="hljs-params"> url, done </span>) </span>{
	<span class="hljs-keyword">var</span> body = <span class="hljs-string">""</span>;
	<span class="hljs-keyword">var</span> req = http.request( url, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> res </span>) </span>{
		res.setEncoding( <span class="hljs-string">'utf8'</span> );
		res.on( <span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> chunk </span>) </span>{
			body += chunk;
		} );

		res.on( <span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			done( <span class="hljs-literal">null</span>, body );
		} );
		res.on( <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>) </span>{
			done( <span class="hljs-string">'problem with response: '</span> + e.message );
		} );
	} );

	req.on( <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>) </span>{
		done( <span class="hljs-string">'problem with request: '</span> + e.message );
	} );
	req.end();
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
