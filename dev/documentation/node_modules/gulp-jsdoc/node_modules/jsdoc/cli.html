<!DOCTYPE html>

<html>
<head>
  <title>cli.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>cli.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * Helper methods for running JSDoc on the command line.
 *
 * A few critical notes for anyone who works on this module:
 *
 * + The module should really export an instance of `cli`, and `props` should be properties of a
 * `cli` instance. However, Rhino interpreted `this` as a reference to `global` within the
 * prototype's methods, so we couldn't do that.
 * + On Rhino, for unknown reasons, the `jsdoc/fs` and `jsdoc/path` modules can fail in some cases
 * when they are required by this module. You may need to use `fs` and `path` instead.
 *
 * @private
 */</span>
<span class="hljs-built_in">module</span>.exports = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-pi">'use strict'</span>;

<span class="hljs-keyword">var</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/util/logger'</span>);

<span class="hljs-keyword">var</span> hasOwnProp = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty;

<span class="hljs-keyword">var</span> props = {
    docs: [],
    packageJson: <span class="hljs-literal">null</span>,
    shouldExitWithError: <span class="hljs-literal">false</span>,
    tmpdir: <span class="hljs-literal">null</span>
};

<span class="hljs-keyword">var</span> app = global.app;
<span class="hljs-keyword">var</span> env = global.env;

<span class="hljs-keyword">var</span> FATAL_ERROR_MESSAGE = <span class="hljs-string">'Exiting JSDoc because an error occurred. See the previous log '</span> +
    <span class="hljs-string">'messages for details.'</span>;
<span class="hljs-keyword">var</span> cli = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.setVersionInfo = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>allow this to throw–something is really wrong if we can’t read our own package file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> info = <span class="hljs-built_in">JSON</span>.parse( fs.readFileSync(path.join(env.dirname, <span class="hljs-string">'package.json'</span>), <span class="hljs-string">'utf8'</span>) );

    env.version = {
        number: info.version,
        revision: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>( <span class="hljs-built_in">parseInt</span>(info.revision, <span class="hljs-number">10</span>) ).toUTCString()
    };

    <span class="hljs-keyword">return</span> cli;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.loadConfig = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/opts/args'</span>);
    <span class="hljs-keyword">var</span> Config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/config'</span>);
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/fs'</span>);
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);

    <span class="hljs-keyword">var</span> confPath;
    <span class="hljs-keyword">var</span> isFile;

    <span class="hljs-keyword">var</span> defaultOpts = {
        destination: <span class="hljs-string">'./out/'</span>,
        encoding: <span class="hljs-string">'utf8'</span>
    };

    <span class="hljs-keyword">try</span> {
        env.opts = args.parse(env.args);
    }
    <span class="hljs-keyword">catch</span> (e) {
        cli.exit(<span class="hljs-number">1</span>, e.message + <span class="hljs-string">'\n'</span> + FATAL_ERROR_MESSAGE);
    }

    confPath = env.opts.configure || path.join(env.dirname, <span class="hljs-string">'conf.json'</span>);
    <span class="hljs-keyword">try</span> {
        isFile = fs.statSync(confPath).isFile();
    }
    <span class="hljs-keyword">catch</span>(e) {
        isFile = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> ( !isFile &amp;&amp; !env.opts.configure ) {
        confPath = path.join(env.dirname, <span class="hljs-string">'conf.json.EXAMPLE'</span>);
    }

    <span class="hljs-keyword">try</span> {
        env.conf = <span class="hljs-keyword">new</span> Config( fs.readFileSync(confPath, <span class="hljs-string">'utf8'</span>) )
            .get();
    }
    <span class="hljs-keyword">catch</span> (e) {
        cli.exit(<span class="hljs-number">1</span>, <span class="hljs-string">'Cannot parse the config file '</span> + confPath + <span class="hljs-string">': '</span> + e + <span class="hljs-string">'\n'</span> +
            FATAL_ERROR_MESSAGE);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>look for options on the command line, in the config file, and in the defaults, in that order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    env.opts = _.defaults(env.opts, env.conf.opts, defaultOpts);

    <span class="hljs-keyword">return</span> cli;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.configureLogger = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recoverableError</span>(<span class="hljs-params"></span>) </span>{
        props.shouldExitWithError = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fatalError</span>(<span class="hljs-params"></span>) </span>{
        cli.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">if</span> (env.opts.debug) {
        logger.setLevel(logger.LEVELS.DEBUG);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (env.opts.verbose) {
        logger.setLevel(logger.LEVELS.INFO);
    }

    <span class="hljs-keyword">if</span> (env.opts.pedantic) {
        logger.once(<span class="hljs-string">'logger:warn'</span>, recoverableError);
        logger.once(<span class="hljs-string">'logger:error'</span>, fatalError);
    }
    <span class="hljs-keyword">else</span> {
        logger.once(<span class="hljs-string">'logger:error'</span>, recoverableError);
    }

    logger.once(<span class="hljs-string">'logger:fatal'</span>, fatalError);

    <span class="hljs-keyword">return</span> cli;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.logStart = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    logger.debug( cli.getVersion() );

    logger.debug(<span class="hljs-string">'Environment info: %j'</span>, {
        env: {
            conf: env.conf,
            opts: env.opts
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.logFinish = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> delta;
    <span class="hljs-keyword">var</span> deltaSeconds;

    <span class="hljs-keyword">if</span> (env.run.finish &amp;&amp; env.run.start) {
        delta = env.run.finish.getTime() - env.run.start.getTime();
    }

    <span class="hljs-keyword">if</span> (delta !== <span class="hljs-literal">undefined</span>) {
        deltaSeconds = (delta / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">2</span>);
        logger.info(<span class="hljs-string">'Finished running in %s seconds.'</span>, deltaSeconds);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.runCommand = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
    <span class="hljs-keyword">var</span> cmd;

    <span class="hljs-keyword">var</span> opts = env.opts;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span>(<span class="hljs-params">errorCode</span>) </span>{
        <span class="hljs-keyword">if</span> (!errorCode &amp;&amp; props.shouldExitWithError) {
            cb(<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">else</span> {
            cb(errorCode);
        }
    }

    <span class="hljs-keyword">if</span> (opts.help) {
        cmd = cli.printHelp;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opts.test) {
        cmd = cli.runTests;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opts.version) {
        cmd = cli.printVersion;
    }
    <span class="hljs-keyword">else</span> {
        cmd = cli.main;
    }

    cmd(done);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.printHelp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
    cli.printVersion();
    <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'\n'</span> + <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/opts/args'</span>).help() + <span class="hljs-string">'\n'</span> );
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Visit http://usejsdoc.org for more information.'</span>);
    cb(<span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.runTests = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);

    <span class="hljs-keyword">var</span> runner = <span class="hljs-built_in">require</span>( path.join(env.dirname, <span class="hljs-string">'test/runner'</span>) );

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Running tests...'</span>);
    runner(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">failCount</span>) </span>{
        cb(failCount);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.getVersion = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'JSDoc '</span> + env.version.number + <span class="hljs-string">' ('</span> + env.version.revision + <span class="hljs-string">')'</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.printVersion = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
    <span class="hljs-built_in">console</span>.log( cli.getVersion() );

    <span class="hljs-keyword">if</span> (cb) {
        cb(<span class="hljs-number">0</span>);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.main = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
    cli.scanFiles();

    <span class="hljs-keyword">if</span> (env.sourceFiles.length) {
        cli.createParser()
            .parseFiles()
            .processParseResults();
    }

    env.run.finish = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    cb(<span class="hljs-number">0</span>);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandomId</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> MIN = <span class="hljs-number">100000</span>;
    <span class="hljs-keyword">var</span> MAX = <span class="hljs-number">999999</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (MAX - MIN + <span class="hljs-number">1</span>) + MIN);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createTempDir</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/fs'</span>);
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);
    <span class="hljs-keyword">var</span> wrench = <span class="hljs-built_in">require</span>(<span class="hljs-string">'wrench'</span>);

    <span class="hljs-keyword">var</span> isRhino;
    <span class="hljs-keyword">var</span> tempDirname;
    <span class="hljs-keyword">var</span> tempPath;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>We only need one temp directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (props.tmpdir) {
        <span class="hljs-keyword">return</span> props.tmpdir;
    }

    isRhino = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/util/runtime'</span>).isRhino();
    tempDirname = <span class="hljs-string">'tmp-'</span> + <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">'-'</span> + getRandomId();
    tempPath = path.join(env.dirname, tempDirname);

    <span class="hljs-keyword">try</span> {
        fs.mkdirSync(tempPath);
        props.tmpdir = tempPath;
    }
    <span class="hljs-keyword">catch</span> (e) {
        logger.fatal(<span class="hljs-string">'Unable to create the temp directory %s: %s'</span>, tempPath, e.message);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Delete the temp directory on exit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (isRhino) {
            ( <span class="hljs-keyword">new</span> java.io.File(tempPath) ).deleteOnExit();
        }
        <span class="hljs-keyword">else</span> {
            process.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                wrench.rmdirSyncRecursive(tempPath);
            });
        }

        <span class="hljs-keyword">return</span> tempPath;
    }
    <span class="hljs-keyword">catch</span> (e) {
        logger.error(<span class="hljs-string">'Cannot automatically delete the temp directory %s on exit: %s'</span>, tempPath,
            e.message);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copyResourceDir</span>(<span class="hljs-params">filepath</span>) </span>{
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/fs'</span>);
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);
    <span class="hljs-keyword">var</span> wrench = <span class="hljs-built_in">require</span>(<span class="hljs-string">'wrench'</span>);

    <span class="hljs-keyword">var</span> resourceDir;
    <span class="hljs-keyword">var</span> tmpDir;

    <span class="hljs-keyword">try</span> {
        tmpDir = createTempDir();
        resourceDir = path.join( tmpDir, path.basename(filepath) + <span class="hljs-string">'-'</span> + getRandomId() );
        fs.mkdirSync(resourceDir);

        wrench.copyDirSyncRecursive(filepath, resourceDir);
        <span class="hljs-keyword">return</span> resourceDir;
    }
    <span class="hljs-keyword">catch</span> (e) {
        logger.fatal(<span class="hljs-string">'Unable to copy %s to the temp directory %s: %s'</span>, filepath, resourceDir,
            e.message);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.scanFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> Filter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/src/filter'</span>).Filter;
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/fs'</span>);
    <span class="hljs-keyword">var</span> Readme = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/readme'</span>);

    <span class="hljs-keyword">var</span> filter;
    <span class="hljs-keyword">var</span> opt;

    <span class="hljs-keyword">if</span> (env.conf.source &amp;&amp; env.conf.source.include) {
        env.opts._ = (env.opts._ || []).concat(env.conf.source.include);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>source files named <code>package.json</code> or <code>README.md</code> get special treatment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = env.opts._.length; i &lt; l; i++) {
        opt = env.opts._[i];

        <span class="hljs-keyword">if</span> ( <span class="hljs-regexp">/\bpackage\.json$/i</span>.test(opt) ) {
            props.packageJson = fs.readFileSync(opt, <span class="hljs-string">'utf8'</span>);
            env.opts._.splice(i--, <span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">if</span> ( <span class="hljs-regexp">/(\bREADME|\.md)$/i</span>.test(opt) ) {
            env.opts.readme = <span class="hljs-keyword">new</span> Readme(opt).html;
            env.opts._.splice(i--, <span class="hljs-number">1</span>);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>are there any files to scan and parse?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (env.conf.source &amp;&amp; env.opts._.length) {
        filter = <span class="hljs-keyword">new</span> Filter(env.conf.source);

        env.sourceFiles = app.jsdoc.scanner.scan(env.opts._, (env.opts.recurse? <span class="hljs-number">10</span> : <span class="hljs-literal">undefined</span>),
            filter);
    }

    <span class="hljs-keyword">return</span> cli;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolvePluginPaths</span>(<span class="hljs-params">paths</span>) </span>{
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);

    <span class="hljs-keyword">var</span> isNode = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/util/runtime'</span>).isNode();
    <span class="hljs-keyword">var</span> pluginPaths = [];

    paths.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) </span>{
        <span class="hljs-keyword">var</span> basename = path.basename(plugin);
        <span class="hljs-keyword">var</span> dirname = path.dirname(plugin);
        <span class="hljs-keyword">var</span> pluginPath = path.getResourcePath(dirname);

        <span class="hljs-keyword">if</span> (!pluginPath) {
            logger.error(<span class="hljs-string">'Unable to find the plugin "%s"'</span>, plugin);
            <span class="hljs-keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>On Node.js, the plugin needs to be inside the JSDoc directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( isNode &amp;&amp; (pluginPath.indexOf(global.env.dirname) !== <span class="hljs-number">0</span>) ) {
            pluginPath = copyResourceDir(pluginPath);
        }

        pluginPaths.push( path.join(pluginPath, basename) );
    });

    <span class="hljs-keyword">return</span> pluginPaths;
}

cli.createParser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> handlers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/src/handlers'</span>);
    <span class="hljs-keyword">var</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/src/parser'</span>);
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);
    <span class="hljs-keyword">var</span> plugins = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/plugins'</span>);

    app.jsdoc.parser = parser.createParser(env.conf.parser);

    <span class="hljs-keyword">if</span> (env.conf.plugins) {
        env.conf.plugins = resolvePluginPaths(env.conf.plugins);
        plugins.installPlugins(env.conf.plugins, app.jsdoc.parser);
    }

    handlers.attachTo(app.jsdoc.parser);

    <span class="hljs-keyword">return</span> cli;
};

cli.parseFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> augment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/augment'</span>);
    <span class="hljs-keyword">var</span> borrow = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/borrow'</span>);
    <span class="hljs-keyword">var</span> Package = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/package'</span>).Package;

    <span class="hljs-keyword">var</span> docs;
    <span class="hljs-keyword">var</span> packageDocs;

    props.docs = docs = app.jsdoc.parser.parse(env.sourceFiles, env.opts.encoding);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If there is no package.json, just create an empty package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    packageDocs = <span class="hljs-keyword">new</span> Package(props.packageJson);
    packageDocs.files = env.sourceFiles || [];
    docs.push(packageDocs);

    logger.debug(<span class="hljs-string">'Adding inherited symbols...'</span>);
    borrow.indexAll(docs);
    augment.addInherited(docs);
    borrow.resolveBorrows(docs);

    app.jsdoc.parser.fireProcessingComplete(docs);

    <span class="hljs-keyword">return</span> cli;
};

cli.processParseResults = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (env.opts.explain) {
        cli.dumpParseResults();
    }
    <span class="hljs-keyword">else</span> {
        cli.resolveTutorials();
        cli.generateDocs();
    }

    <span class="hljs-keyword">return</span> cli;
};

cli.dumpParseResults = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    global.dump(props.docs);

    <span class="hljs-keyword">return</span> cli;
};

cli.resolveTutorials = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> resolver = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/tutorial/resolver'</span>);

    <span class="hljs-keyword">if</span> (env.opts.tutorials) {
        resolver.load(env.opts.tutorials);
        resolver.resolve();
    }

    <span class="hljs-keyword">return</span> cli;
};

cli.generateDocs = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/path'</span>);
    <span class="hljs-keyword">var</span> resolver = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/tutorial/resolver'</span>);
    <span class="hljs-keyword">var</span> taffy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'taffydb'</span>).taffy;

    <span class="hljs-keyword">var</span> template;

    env.opts.template = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> isNode = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/util/runtime'</span>).isNode();
        <span class="hljs-keyword">var</span> publish = env.opts.template || <span class="hljs-string">'templates/default'</span>;
        <span class="hljs-keyword">var</span> templatePath = path.getResourcePath(publish);

        <span class="hljs-keyword">if</span> (templatePath &amp;&amp; isNode) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>On Node.js, the template needs to be inside the JSDoc folder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (templatePath.indexOf(env.dirname) !== <span class="hljs-number">0</span>) {
                templatePath = copyResourceDir(templatePath);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>if we didn’t find the template, keep the user-specified value so the error message is
useful</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> templatePath || env.opts.template;
    })();

    <span class="hljs-keyword">try</span> {
        template = <span class="hljs-built_in">require</span>(env.opts.template + <span class="hljs-string">'/publish'</span>);
    }
    <span class="hljs-keyword">catch</span>(e) {
        logger.fatal(<span class="hljs-string">'Unable to load template: '</span> + e.message || e);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>templates should include a publish.js file that exports a “publish” function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (template.publish &amp;&amp; <span class="hljs-keyword">typeof</span> template.publish === <span class="hljs-string">'function'</span>) {
        logger.printInfo(<span class="hljs-string">'Generating output files...'</span>);
        template.publish(
            taffy(props.docs),
            env.opts,
            resolver.root
        );
        logger.info(<span class="hljs-string">'complete.'</span>);
    }
    <span class="hljs-keyword">else</span> {
        logger.fatal(env.opts.template + <span class="hljs-string">' does not export a "publish" function. Global '</span> +
            <span class="hljs-string">'"publish" functions are no longer supported.'</span>);
    }

    <span class="hljs-keyword">return</span> cli;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>TODO: docs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cli.exit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">exitCode, message</span>) </span>{
    <span class="hljs-keyword">if</span> (message &amp;&amp; exitCode &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">console</span>.error(message);
    }

    process.exit(exitCode || <span class="hljs-number">0</span>);
};

<span class="hljs-keyword">return</span> cli;

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
