<!DOCTYPE html>

<html>
<head>
  <title>node-demo.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>node-demo.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> TAFFY = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./taffy"</span>).taffy;

<span class="hljs-built_in">console</span>.log(TAFFY);

<span class="hljs-keyword">var</span> friendList = [
	{<span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"gender"</span>:<span class="hljs-string">"M"</span>,<span class="hljs-string">"first"</span>:<span class="hljs-string">"John"</span>,<span class="hljs-string">"last"</span>:<span class="hljs-string">"Smith"</span>,
    	<span class="hljs-string">"city"</span>:<span class="hljs-string">"Seattle, WA"</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">"Active"</span>},
  	{<span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>,<span class="hljs-string">"gender"</span>:<span class="hljs-string">"F"</span>,<span class="hljs-string">"first"</span>:<span class="hljs-string">"Kelly"</span>,<span class="hljs-string">"last"</span>:<span class="hljs-string">"Ruth"</span>,
    	<span class="hljs-string">"city"</span>:<span class="hljs-string">"Dallas, TX"</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">"Active"</span>},
  	{<span class="hljs-string">"id"</span>:<span class="hljs-number">3</span>,<span class="hljs-string">"gender"</span>:<span class="hljs-string">"M"</span>,<span class="hljs-string">"first"</span>:<span class="hljs-string">"Jeff"</span>,<span class="hljs-string">"last"</span>:<span class="hljs-string">"Stevenson"</span>,
    	<span class="hljs-string">"city"</span>:<span class="hljs-string">"Washington, D.C."</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">"Active"</span>},
  	{<span class="hljs-string">"id"</span>:<span class="hljs-number">4</span>,<span class="hljs-string">"gender"</span>:<span class="hljs-string">"F"</span>,<span class="hljs-string">"first"</span>:<span class="hljs-string">"Jennifer"</span>,<span class="hljs-string">"last"</span>:<span class="hljs-string">"Gill"</span>,
    	<span class="hljs-string">"city"</span>:<span class="hljs-string">"Seattle, WA"</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">"Active"</span>}  
];

<span class="hljs-keyword">var</span> friend_db = TAFFY(friendList);

<span class="hljs-keyword">var</span> taffy_map = {
  by_city         : friend_db({ city : <span class="hljs-string">"Seattle, WA"</span>}),
  by_id           : friend_db({ id : <span class="hljs-number">1</span>}),
  by_id_f         : friend_db({ id : <span class="hljs-string">'1'</span>}),
  by_name         : friend_db({ first : <span class="hljs-string">'John'</span>,last:<span class="hljs-string">'Smith'</span>}),
  kelly_by_id     : friend_db({ id : <span class="hljs-number">2</span>}).first(),
  kelly_last_name : friend_db({ id : <span class="hljs-number">2</span>}).first().last,
  id_list         : friend_db().select( <span class="hljs-string">'id'</span> ),
  city_list       : friend_db().distinct( <span class="hljs-string">'city'</span> ),
  filter_list     : friend_db().filter({ city : <span class="hljs-string">"Seattle, WA"</span>})
};

<span class="hljs-keyword">for</span> ( key_name <span class="hljs-keyword">in</span> taffy_map ){
  <span class="hljs-keyword">if</span> ( taffy_map.hasOwnProperty( key_name ) ) {
    data_val = taffy_map[ key_name ];

    <span class="hljs-keyword">var</span> var_type = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-literal">undefined</span> === data_val ){ 
    	var_type = <span class="hljs-string">'Undefined'</span>; 
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data_val === <span class="hljs-literal">null</span> ){ 
    	var_type = <span class="hljs-string">'Null'</span>; 
    }
    <span class="hljs-keyword">else</span>{
    	var_type = {}.toString.call(data_val).slice(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>);
    } 

    msg_text = key_name + <span class="hljs-string">': \n ===================\n'</span>;

    <span class="hljs-keyword">switch</span> ( var_type ){
      <span class="hljs-keyword">case</span> <span class="hljs-string">'Object'</span>   :
        <span class="hljs-keyword">if</span> ( data_val.hasOwnProperty( <span class="hljs-string">'get'</span> ) ){
          msg_text += <span class="hljs-built_in">JSON</span>.stringify( data_val.get() );
        }
        <span class="hljs-keyword">else</span> {
          msg_text += <span class="hljs-built_in">JSON</span>.stringify( data_val );
        }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'Number'</span> :
        msg_text += <span class="hljs-built_in">String</span>( data_val );
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">default</span> :
        msg_text += <span class="hljs-built_in">JSON</span>.stringify( data_val );
    }

    msg_text += <span class="hljs-string">'\n\n'</span>;

    <span class="hljs-built_in">console</span>.log( msg_text );
  }
}

<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'Example filter bug - rows changed without using '</span>
  + <span class="hljs-string">'.update() will filter by their original values. '</span>
);
friend_db().each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> row_map, idx </span>) </span>{
  <span class="hljs-keyword">if</span> ( row_map.city === <span class="hljs-string">'Seattle, WA'</span> ){
    row_map.city = <span class="hljs-string">'WallaWalla, WA'</span>;
  }
});

<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'We expect 0 rows, but get 2... '</span> );
<span class="hljs-built_in">console</span>.log(
  friend_db().filter({ city : <span class="hljs-string">'Seattle, WA'</span>}).get()
);
<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'...even though the city has changed in the collection.'</span> );
<span class="hljs-built_in">console</span>.log( friend_db().get() );
<span class="hljs-built_in">console</span>.log( <span class="hljs-string">''</span> );

<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'Example filter when .update() is used.'</span>);
friend_db = TAFFY( friendList );

friend_db({ city : <span class="hljs-string">'Seattle, WA'</span> })
  .update({ city : <span class="hljs-string">'WallaWalla, WA'</span> });

<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'now we get the correct response (0 rows) ...'</span> );
<span class="hljs-built_in">console</span>.log( 
  friend_db().filter({ city : <span class="hljs-string">'Seattle, WA'</span>}).get()
);
<span class="hljs-built_in">console</span>.log( friend_db().get() );
<span class="hljs-built_in">console</span>.log( <span class="hljs-string">'... that reflects the taffy collection.'</span> );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
