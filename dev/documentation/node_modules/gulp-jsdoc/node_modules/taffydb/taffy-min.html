<!DOCTYPE html>

<html>
<head>
  <title>taffy-min.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>taffy-min.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> TAFFY,exports,T;(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> f,q,p,t,d,b,n,m,r,e,c,u,w,v,h,g,j,o,i,l,a,s,k;<span class="hljs-keyword">if</span>(!TAFFY){d=<span class="hljs-string">"2.7"</span>;b=<span class="hljs-number">1</span>;n=<span class="hljs-string">"000000"</span>;m=<span class="hljs-number">1000</span>;r={};e=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">if</span>(TAFFY.isArray(x)||TAFFY.isObject(x)){<span class="hljs-keyword">return</span> x}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(x)}};i=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y,x</span>)</span>{<span class="hljs-keyword">return</span> l(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">return</span> x.indexOf(z)&gt;=<span class="hljs-number">0</span>})};l=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,z,y</span>)</span>{<span class="hljs-keyword">var</span> x=[];<span class="hljs-keyword">if</span>(A==<span class="hljs-literal">null</span>){<span class="hljs-keyword">return</span> x}<span class="hljs-keyword">if</span>(<span class="hljs-built_in">Array</span>.prototype.filter&amp;&amp;A.filter===<span class="hljs-built_in">Array</span>.prototype.filter){<span class="hljs-keyword">return</span> A.filter(z,y)}c(A,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">D,B,C</span>)</span>{<span class="hljs-keyword">if</span>(z.call(y,D,B,C)){x[x.length]=D}});<span class="hljs-keyword">return</span> x};k=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(x)===<span class="hljs-string">"[object RegExp]"</span>};s=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">var</span> x=T.isArray(z)?[]:T.isObject(z)?{}:<span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(z===<span class="hljs-literal">null</span>){<span class="hljs-keyword">return</span> z}<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> y <span class="hljs-keyword">in</span> z){x[y]=k(z[y])?z[y].toString():T.isArray(z[y])||T.isObject(z[y])?s(z[y]):z[y]}<span class="hljs-keyword">return</span> x};a=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">var</span> x=<span class="hljs-built_in">JSON</span>.stringify(y);<span class="hljs-keyword">if</span>(x.match(<span class="hljs-regexp">/regex/</span>)===<span class="hljs-literal">null</span>){<span class="hljs-keyword">return</span> x}<span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(s(y))};c=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,A,C</span>)</span>{<span class="hljs-keyword">var</span> E,D,z,F;<span class="hljs-keyword">if</span>(B&amp;&amp;((T.isArray(B)&amp;&amp;B.length===<span class="hljs-number">1</span>)||(!T.isArray(B)))){A((T.isArray(B))?B[<span class="hljs-number">0</span>]:B,<span class="hljs-number">0</span>)}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">for</span>(E,D,z=<span class="hljs-number">0</span>,B=(T.isArray(B))?B:[B],F=B.length;z&lt;F;z++){D=B[z];<span class="hljs-keyword">if</span>(!T.isUndefined(D)||(C||<span class="hljs-literal">false</span>)){E=A(D,z);<span class="hljs-keyword">if</span>(E===T.EXIT){<span class="hljs-keyword">break</span>}}}}};u=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C,z</span>)</span>{<span class="hljs-keyword">var</span> y=<span class="hljs-number">0</span>,B,A;<span class="hljs-keyword">for</span>(A <span class="hljs-keyword">in</span> C){<span class="hljs-keyword">if</span>(C.hasOwnProperty(A)){B=z(C[A],A,y++);<span class="hljs-keyword">if</span>(B===T.EXIT){<span class="hljs-keyword">break</span>}}}};r.extend=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x,y</span>)</span>{r[x]=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">return</span> y.apply(<span class="hljs-keyword">this</span>,<span class="hljs-built_in">arguments</span>)}};w=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">var</span> x;<span class="hljs-keyword">if</span>(T.isString(y)&amp;&amp;<span class="hljs-regexp">/[t][0-9]*[r][0-9]*/i</span>.test(y)){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">if</span>(T.isObject(y)&amp;&amp;y.___id&amp;&amp;y.___s){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">if</span>(T.isArray(y)){x=<span class="hljs-literal">true</span>;c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">if</span>(!w(z)){x=<span class="hljs-literal">false</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">return</span> x}<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>};h=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z,y</span>)</span>{<span class="hljs-keyword">var</span> x=<span class="hljs-literal">true</span>;c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A</span>)</span>{<span class="hljs-keyword">switch</span>(T.typeOf(A)){<span class="hljs-keyword">case</span><span class="hljs-string">"function"</span>:<span class="hljs-keyword">if</span>(!A.apply(z)){x=<span class="hljs-literal">false</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}<span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span><span class="hljs-string">"array"</span>:x=(A.length===<span class="hljs-number">1</span>)?(h(z,A[<span class="hljs-number">0</span>])):(A.length===<span class="hljs-number">2</span>)?(h(z,A[<span class="hljs-number">0</span>])||h(z,A[<span class="hljs-number">1</span>])):(A.length===<span class="hljs-number">3</span>)?(h(z,A[<span class="hljs-number">0</span>])||h(z,A[<span class="hljs-number">1</span>])||h(z,A[<span class="hljs-number">2</span>])):(A.length===<span class="hljs-number">4</span>)?(h(z,A[<span class="hljs-number">0</span>])||h(z,A[<span class="hljs-number">1</span>])||h(z,A[<span class="hljs-number">2</span>])||h(z,A[<span class="hljs-number">3</span>])):<span class="hljs-literal">false</span>;<span class="hljs-keyword">if</span>(A.length&gt;<span class="hljs-number">4</span>){c(A,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B</span>)</span>{<span class="hljs-keyword">if</span>(h(z,B)){x=<span class="hljs-literal">true</span>}})}<span class="hljs-keyword">break</span>}});<span class="hljs-keyword">return</span> x};v=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">var</span> x=[];<span class="hljs-keyword">if</span>(T.isString(y)&amp;&amp;<span class="hljs-regexp">/[t][0-9]*[r][0-9]*/i</span>.test(y)){y={___id:y}}<span class="hljs-keyword">if</span>(T.isArray(y)){c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{x.push(v(z))});y=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> A=<span class="hljs-keyword">this</span>,z=<span class="hljs-literal">false</span>;c(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B</span>)</span>{<span class="hljs-keyword">if</span>(h(A,B)){z=<span class="hljs-literal">true</span>}});<span class="hljs-keyword">return</span> z};<span class="hljs-keyword">return</span> y}<span class="hljs-keyword">if</span>(T.isObject(y)){<span class="hljs-keyword">if</span>(T.isObject(y)&amp;&amp;y.___id&amp;&amp;y.___s){y={___id:y.___id}}u(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z,A</span>)</span>{<span class="hljs-keyword">if</span>(!T.isObject(z)){z={is:z}}u(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,C</span>)</span>{<span class="hljs-keyword">var</span> E=[],D;D=(C===<span class="hljs-string">"hasAll"</span>)?<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">F,G</span>)</span>{G(F)}:c;D(B,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">G</span>)</span>{<span class="hljs-keyword">var</span> F=<span class="hljs-literal">true</span>,H=<span class="hljs-literal">false</span>,I;I=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> N=<span class="hljs-keyword">this</span>[A],M=<span class="hljs-string">"=="</span>,O=<span class="hljs-string">"!="</span>,Q=<span class="hljs-string">"==="</span>,R=<span class="hljs-string">"&lt;"</span>,L=<span class="hljs-string">"&gt;"</span>,S=<span class="hljs-string">"&lt;="</span>,P=<span class="hljs-string">"&gt;="</span>,K=<span class="hljs-string">"!=="</span>,J;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> N===<span class="hljs-string">"undefined"</span>){<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>}<span class="hljs-keyword">if</span>((C.indexOf(<span class="hljs-string">"!"</span>)===<span class="hljs-number">0</span>)&amp;&amp;C!==O&amp;&amp;C!==K){F=<span class="hljs-literal">false</span>;C=C.substring(<span class="hljs-number">1</span>,C.length)}J=((C===<span class="hljs-string">"regex"</span>)?(G.test(N)):(C===<span class="hljs-string">"lt"</span>||C===R)?(N&lt;G):(C===<span class="hljs-string">"gt"</span>||C===L)?(N&gt;G):(C===<span class="hljs-string">"lte"</span>||C===S)?(N&lt;=G):(C===<span class="hljs-string">"gte"</span>||C===P)?(N&gt;=G):(C===<span class="hljs-string">"left"</span>)?(N.indexOf(G)===<span class="hljs-number">0</span>):(C===<span class="hljs-string">"leftnocase"</span>)?(N.toLowerCase().indexOf(G.toLowerCase())===<span class="hljs-number">0</span>):(C===<span class="hljs-string">"right"</span>)?(N.substring((N.length-G.length))===G):(C===<span class="hljs-string">"rightnocase"</span>)?(N.toLowerCase().substring((N.length-G.length))===G.toLowerCase()):(C===<span class="hljs-string">"like"</span>)?(N.indexOf(G)&gt;=<span class="hljs-number">0</span>):(C===<span class="hljs-string">"likenocase"</span>)?(N.toLowerCase().indexOf(G.toLowerCase())&gt;=<span class="hljs-number">0</span>):(C===Q||C===<span class="hljs-string">"is"</span>)?(N===G):(C===M)?(N==G):(C===K)?(N!==G):(C===O)?(N!=G):(C===<span class="hljs-string">"isnocase"</span>)?(N.toLowerCase?N.toLowerCase()===G.toLowerCase():N===G):(C===<span class="hljs-string">"has"</span>)?(T.has(N,G)):(C===<span class="hljs-string">"hasall"</span>)?(T.hasAll(N,G)):(C===<span class="hljs-string">"contains"</span>)?(TAFFY.isArray(N)&amp;&amp;N.indexOf(G)&gt;-<span class="hljs-number">1</span>):(C.indexOf(<span class="hljs-string">"is"</span>)===-<span class="hljs-number">1</span>&amp;&amp;!TAFFY.isNull(N)&amp;&amp;!TAFFY.isUndefined(N)&amp;&amp;!TAFFY.isObject(G)&amp;&amp;!TAFFY.isArray(G))?(G===N[C]):(T[C]&amp;&amp;T.isFunction(T[C])&amp;&amp;C.indexOf(<span class="hljs-string">"is"</span>)===<span class="hljs-number">0</span>)?T[C](N)===G:(T[C]&amp;&amp;T.isFunction(T[C]))?T[C](N,G):(<span class="hljs-literal">false</span>));J=(J&amp;&amp;!F)?<span class="hljs-literal">false</span>:(!J&amp;&amp;!F)?<span class="hljs-literal">true</span>:J;<span class="hljs-keyword">return</span> J};E.push(I)});<span class="hljs-keyword">if</span>(E.length===<span class="hljs-number">1</span>){x.push(E[<span class="hljs-number">0</span>])}<span class="hljs-keyword">else</span>{x.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> G=<span class="hljs-keyword">this</span>,F=<span class="hljs-literal">false</span>;c(E,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">H</span>)</span>{<span class="hljs-keyword">if</span>(H.apply(G)){F=<span class="hljs-literal">true</span>}});<span class="hljs-keyword">return</span> F})}})});y=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> A=<span class="hljs-keyword">this</span>,z=<span class="hljs-literal">true</span>;z=(x.length===<span class="hljs-number">1</span>&amp;&amp;!x[<span class="hljs-number">0</span>].apply(A))?<span class="hljs-literal">false</span>:(x.length===<span class="hljs-number">2</span>&amp;&amp;(!x[<span class="hljs-number">0</span>].apply(A)||!x[<span class="hljs-number">1</span>].apply(A)))?<span class="hljs-literal">false</span>:(x.length===<span class="hljs-number">3</span>&amp;&amp;(!x[<span class="hljs-number">0</span>].apply(A)||!x[<span class="hljs-number">1</span>].apply(A)||!x[<span class="hljs-number">2</span>].apply(A)))?<span class="hljs-literal">false</span>:(x.length===<span class="hljs-number">4</span>&amp;&amp;(!x[<span class="hljs-number">0</span>].apply(A)||!x[<span class="hljs-number">1</span>].apply(A)||!x[<span class="hljs-number">2</span>].apply(A)||!x[<span class="hljs-number">3</span>].apply(A)))?<span class="hljs-literal">false</span>:<span class="hljs-literal">true</span>;<span class="hljs-keyword">if</span>(x.length&gt;<span class="hljs-number">4</span>){c(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B</span>)</span>{<span class="hljs-keyword">if</span>(!h(A,B)){z=<span class="hljs-literal">false</span>}})}<span class="hljs-keyword">return</span> z};<span class="hljs-keyword">return</span> y}<span class="hljs-keyword">if</span>(T.isFunction(y)){<span class="hljs-keyword">return</span> y}};j=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x,y</span>)</span>{<span class="hljs-keyword">var</span> z=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,A</span>)</span>{<span class="hljs-keyword">var</span> C=<span class="hljs-number">0</span>;T.each(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">F</span>)</span>{<span class="hljs-keyword">var</span> H,E,D,I,G;H=F.split(<span class="hljs-string">" "</span>);E=H[<span class="hljs-number">0</span>];D=(H.length===<span class="hljs-number">1</span>)?<span class="hljs-string">"logical"</span>:H[<span class="hljs-number">1</span>];<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"logical"</span>){I=g(B[E]);G=g(A[E]);T.each((I.length&lt;=G.length)?I:G,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J,K</span>)</span>{<span class="hljs-keyword">if</span>(I[K]&lt;G[K]){C=-<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(I[K]&gt;G[K]){C=<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"logicaldesc"</span>){I=g(B[E]);G=g(A[E]);T.each((I.length&lt;=G.length)?I:G,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J,K</span>)</span>{<span class="hljs-keyword">if</span>(I[K]&gt;G[K]){C=-<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(I[K]&lt;G[K]){C=<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"asec"</span>&amp;&amp;B[E]&lt;A[E]){C=-<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> T.EXIT}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"asec"</span>&amp;&amp;B[E]&gt;A[E]){C=<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> T.EXIT}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"desc"</span>&amp;&amp;B[E]&gt;A[E]){C=-<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> T.EXIT}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(D===<span class="hljs-string">"desc"</span>&amp;&amp;B[E]&lt;A[E]){C=<span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> T.EXIT}}}}}}<span class="hljs-keyword">if</span>(C===<span class="hljs-number">0</span>&amp;&amp;D===<span class="hljs-string">"logical"</span>&amp;&amp;I.length&lt;G.length){C=-<span class="hljs-number">1</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(C===<span class="hljs-number">0</span>&amp;&amp;D===<span class="hljs-string">"logical"</span>&amp;&amp;I.length&gt;G.length){C=<span class="hljs-number">1</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(C===<span class="hljs-number">0</span>&amp;&amp;D===<span class="hljs-string">"logicaldesc"</span>&amp;&amp;I.length&gt;G.length){C=-<span class="hljs-number">1</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(C===<span class="hljs-number">0</span>&amp;&amp;D===<span class="hljs-string">"logicaldesc"</span>&amp;&amp;I.length&lt;G.length){C=<span class="hljs-number">1</span>}}}}<span class="hljs-keyword">if</span>(C!==<span class="hljs-number">0</span>){<span class="hljs-keyword">return</span> T.EXIT}});<span class="hljs-keyword">return</span> C};<span class="hljs-keyword">return</span>(x&amp;&amp;x.push)?x.sort(z):x};(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> x={},y=<span class="hljs-number">0</span>;g=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">if</span>(y&gt;m){x={};y=<span class="hljs-number">0</span>}<span class="hljs-keyword">return</span> x[<span class="hljs-string">"_"</span>+z]||(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> D=<span class="hljs-built_in">String</span>(z),C=[],G=<span class="hljs-string">"_"</span>,B=<span class="hljs-string">""</span>,A,E,F;<span class="hljs-keyword">for</span>(A=<span class="hljs-number">0</span>,E=D.length;A&lt;E;A++){F=D.charCodeAt(A);<span class="hljs-keyword">if</span>((F&gt;=<span class="hljs-number">48</span>&amp;&amp;F&lt;=<span class="hljs-number">57</span>)||F===<span class="hljs-number">46</span>){<span class="hljs-keyword">if</span>(B!==<span class="hljs-string">"n"</span>){B=<span class="hljs-string">"n"</span>;C.push(G.toLowerCase());G=<span class="hljs-string">""</span>}G=G+D.charAt(A)}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(B!==<span class="hljs-string">"s"</span>){B=<span class="hljs-string">"s"</span>;C.push(<span class="hljs-built_in">parseFloat</span>(G));G=<span class="hljs-string">""</span>}G=G+D.charAt(A)}}C.push((B===<span class="hljs-string">"n"</span>)?<span class="hljs-built_in">parseFloat</span>(G):G.toLowerCase());C.shift();x[<span class="hljs-string">"_"</span>+z]=C;y++;<span class="hljs-keyword">return</span> C}())}}());o=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">this</span>.context({results:<span class="hljs-keyword">this</span>.getDBI().query(<span class="hljs-keyword">this</span>.context())})};r.extend(<span class="hljs-string">"filter"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> y=TAFFY.mergeObj(<span class="hljs-keyword">this</span>.context(),{run:<span class="hljs-literal">null</span>}),x=[];c(y.q,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{x.push(z)});y.q=x;c(<span class="hljs-built_in">arguments</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{y.q.push(v(z));y.filterRaw.push(z)});<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getroot(y)});r.extend(<span class="hljs-string">"order"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{z=z.split(<span class="hljs-string">","</span>);<span class="hljs-keyword">var</span> y=[],A;c(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{y.push(x.replace(<span class="hljs-regexp">/^\s*/</span>,<span class="hljs-string">""</span>).replace(<span class="hljs-regexp">/\s*$/</span>,<span class="hljs-string">""</span>))});A=TAFFY.mergeObj(<span class="hljs-keyword">this</span>.context(),{sort:<span class="hljs-literal">null</span>});A.order=y;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getroot(A)});r.extend(<span class="hljs-string">"limit"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">var</span> y=TAFFY.mergeObj(<span class="hljs-keyword">this</span>.context(),{}),x;y.limit=z;<span class="hljs-keyword">if</span>(y.run&amp;&amp;y.sort){x=[];c(y.results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,A</span>)</span>{<span class="hljs-keyword">if</span>((A+<span class="hljs-number">1</span>)&gt;z){<span class="hljs-keyword">return</span> TAFFY.EXIT}x.push(B)});y.results=x}<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getroot(y)});r.extend(<span class="hljs-string">"start"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">var</span> y=TAFFY.mergeObj(<span class="hljs-keyword">this</span>.context(),{}),x;y.start=z;<span class="hljs-keyword">if</span>(y.run&amp;&amp;y.sort&amp;&amp;!y.limit){x=[];c(y.results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,A</span>)</span>{<span class="hljs-keyword">if</span>((A+<span class="hljs-number">1</span>)&gt;z){x.push(B)}});y.results=x}<span class="hljs-keyword">else</span>{y=TAFFY.mergeObj(<span class="hljs-keyword">this</span>.context(),{run:<span class="hljs-literal">null</span>,start:z})}<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getroot(y)});r.extend(<span class="hljs-string">"update"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,z,x</span>)</span>{<span class="hljs-keyword">var</span> B=<span class="hljs-literal">true</span>,D={},y=<span class="hljs-built_in">arguments</span>,C;<span class="hljs-keyword">if</span>(TAFFY.isString(A)&amp;&amp;(<span class="hljs-built_in">arguments</span>.length===<span class="hljs-number">2</span>||<span class="hljs-built_in">arguments</span>.length===<span class="hljs-number">3</span>)){D[A]=z;<span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length===<span class="hljs-number">3</span>){B=x}}<span class="hljs-keyword">else</span>{D=A;<span class="hljs-keyword">if</span>(y.length===<span class="hljs-number">2</span>){B=z}}C=<span class="hljs-keyword">this</span>;o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">E</span>)</span>{<span class="hljs-keyword">var</span> F=D;<span class="hljs-keyword">if</span>(TAFFY.isFunction(F)){F=F.apply(TAFFY.mergeObj(E,{}))}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isFunction(F)){F=F(TAFFY.mergeObj(E,{}))}}<span class="hljs-keyword">if</span>(TAFFY.isObject(F)){C.getDBI().update(E.___id,F,B)}});<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.context().results.length){<span class="hljs-keyword">this</span>.context({run:<span class="hljs-literal">null</span>})}<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>});r.extend(<span class="hljs-string">"remove"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">var</span> y=<span class="hljs-keyword">this</span>,z=<span class="hljs-number">0</span>;o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A</span>)</span>{y.getDBI().remove(A.___id);z++});<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.context().results.length){<span class="hljs-keyword">this</span>.context({run:<span class="hljs-literal">null</span>});y.getDBI().removeCommit(x)}<span class="hljs-keyword">return</span> z});r.extend(<span class="hljs-string">"count"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context().results.length});r.extend(<span class="hljs-string">"callback"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z,x</span>)</span>{<span class="hljs-keyword">if</span>(z){<span class="hljs-keyword">var</span> y=<span class="hljs-keyword">this</span>;setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{o.call(y);z.call(y.getroot(y.context()))},x||<span class="hljs-number">0</span>)}<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>});r.extend(<span class="hljs-string">"get"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context().results});r.extend(<span class="hljs-string">"stringify"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.get())});r.extend(<span class="hljs-string">"first"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context().results[<span class="hljs-number">0</span>]||<span class="hljs-literal">false</span>});r.extend(<span class="hljs-string">"last"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context().results[<span class="hljs-keyword">this</span>.context().results.length-<span class="hljs-number">1</span>]||<span class="hljs-literal">false</span>});r.extend(<span class="hljs-string">"sum"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> y=<span class="hljs-number">0</span>,x=<span class="hljs-keyword">this</span>;o.call(x);c(<span class="hljs-built_in">arguments</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{c(x.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A</span>)</span>{y=y+(A[z]||<span class="hljs-number">0</span>)})});<span class="hljs-keyword">return</span> y});r.extend(<span class="hljs-string">"min"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">var</span> x=<span class="hljs-literal">null</span>;o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">null</span>||z[y]&lt;x){x=z[y]}});<span class="hljs-keyword">return</span> x});(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> x=(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> A,y,z;A=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">E,G,D</span>)</span>{<span class="hljs-keyword">var</span> C,F,H,B;<span class="hljs-keyword">if</span>(D.length===<span class="hljs-number">2</span>){C=E[D[<span class="hljs-number">0</span>]];H=<span class="hljs-string">"==="</span>;F=G[D[<span class="hljs-number">1</span>]]}<span class="hljs-keyword">else</span>{C=E[D[<span class="hljs-number">0</span>]];H=D[<span class="hljs-number">1</span>];F=G[D[<span class="hljs-number">2</span>]]}<span class="hljs-keyword">switch</span>(H){<span class="hljs-keyword">case</span><span class="hljs-string">"==="</span>:<span class="hljs-keyword">return</span> C===F;<span class="hljs-keyword">case</span><span class="hljs-string">"!=="</span>:<span class="hljs-keyword">return</span> C!==F;<span class="hljs-keyword">case</span><span class="hljs-string">"&lt;"</span>:<span class="hljs-keyword">return</span> C&lt;F;<span class="hljs-keyword">case</span><span class="hljs-string">"&gt;"</span>:<span class="hljs-keyword">return</span> C&gt;F;<span class="hljs-keyword">case</span><span class="hljs-string">"&lt;="</span>:<span class="hljs-keyword">return</span> C&lt;=F;<span class="hljs-keyword">case</span><span class="hljs-string">"&gt;="</span>:<span class="hljs-keyword">return</span> C&gt;=F;<span class="hljs-keyword">case</span><span class="hljs-string">"=="</span>:<span class="hljs-keyword">return</span> C==F;<span class="hljs-keyword">case</span><span class="hljs-string">"!="</span>:<span class="hljs-keyword">return</span> C!=F;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">throw</span> <span class="hljs-built_in">String</span>(H)+<span class="hljs-string">" is not supported"</span>}};y=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C,F</span>)</span>{<span class="hljs-keyword">var</span> B={},D,E;<span class="hljs-keyword">for</span>(D <span class="hljs-keyword">in</span> C){<span class="hljs-keyword">if</span>(C.hasOwnProperty(D)){B[D]=C[D]}}<span class="hljs-keyword">for</span>(D <span class="hljs-keyword">in</span> F){<span class="hljs-keyword">if</span>(F.hasOwnProperty(D)&amp;&amp;D!==<span class="hljs-string">"___id"</span>&amp;&amp;D!==<span class="hljs-string">"___s"</span>){E=!TAFFY.isUndefined(B[D])?<span class="hljs-string">"right_"</span>:<span class="hljs-string">""</span>;B[E+<span class="hljs-built_in">String</span>(D)]=F[D]}}<span class="hljs-keyword">return</span> B};z=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">F</span>)</span>{<span class="hljs-keyword">var</span> B,D,C=<span class="hljs-built_in">arguments</span>,E=C.length,G=[];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> F.filter!==<span class="hljs-string">"function"</span>){<span class="hljs-keyword">if</span>(F.TAFFY){B=F()}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">throw</span><span class="hljs-string">"TAFFY DB or result not supplied"</span>}}<span class="hljs-keyword">else</span>{B=F}<span class="hljs-keyword">this</span>.context({results:<span class="hljs-keyword">this</span>.getDBI().query(<span class="hljs-keyword">this</span>.context())});TAFFY.each(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">H</span>)</span>{B.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">K</span>)</span>{<span class="hljs-keyword">var</span> I,J=<span class="hljs-literal">true</span>;CONDITION:<span class="hljs-keyword">for</span>(D=<span class="hljs-number">1</span>;D&lt;E;D++){I=C[D];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> I===<span class="hljs-string">"function"</span>){J=I(H,K)}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> I===<span class="hljs-string">"object"</span>&amp;&amp;I.length){J=A(H,K,I)}<span class="hljs-keyword">else</span>{J=<span class="hljs-literal">false</span>}}<span class="hljs-keyword">if</span>(!J){<span class="hljs-keyword">break</span> CONDITION}}<span class="hljs-keyword">if</span>(J){G.push(y(H,K))}})});<span class="hljs-keyword">return</span> TAFFY(G)()};<span class="hljs-keyword">return</span> z}());r.extend(<span class="hljs-string">"join"</span>,x)}());r.extend(<span class="hljs-string">"max"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">var</span> x=<span class="hljs-literal">null</span>;o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">null</span>||z[y]&gt;x){x=z[y]}});<span class="hljs-keyword">return</span> x});r.extend(<span class="hljs-string">"select"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> y=[],x=<span class="hljs-built_in">arguments</span>;o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length===<span class="hljs-number">1</span>){c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{y.push(z[x[<span class="hljs-number">0</span>]])})}<span class="hljs-keyword">else</span>{c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">var</span> A=[];c(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B</span>)</span>{A.push(z[B])});y.push(A)})}<span class="hljs-keyword">return</span> y});r.extend(<span class="hljs-string">"distinct"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> y=[],x=<span class="hljs-built_in">arguments</span>;o.call(<span class="hljs-keyword">this</span>);<span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length===<span class="hljs-number">1</span>){c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A</span>)</span>{<span class="hljs-keyword">var</span> z=A[x[<span class="hljs-number">0</span>]],B=<span class="hljs-literal">false</span>;c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C</span>)</span>{<span class="hljs-keyword">if</span>(z===C){B=<span class="hljs-literal">true</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">if</span>(!B){y.push(z)}})}<span class="hljs-keyword">else</span>{c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{<span class="hljs-keyword">var</span> B=[],A=<span class="hljs-literal">false</span>;c(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C</span>)</span>{B.push(z[C])});c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">D</span>)</span>{<span class="hljs-keyword">var</span> C=<span class="hljs-literal">true</span>;c(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">F,E</span>)</span>{<span class="hljs-keyword">if</span>(B[E]!==D[E]){C=<span class="hljs-literal">false</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">if</span>(C){A=<span class="hljs-literal">true</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">if</span>(!A){y.push(B)}})}<span class="hljs-keyword">return</span> y});r.extend(<span class="hljs-string">"supplant"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y,x</span>)</span>{<span class="hljs-keyword">var</span> z=[];o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A</span>)</span>{z.push(y.replace(<span class="hljs-regexp">/\{([^\{\}]*)\}/g</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C,B</span>)</span>{<span class="hljs-keyword">var</span> D=A[B];<span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> D===<span class="hljs-string">"string"</span>||<span class="hljs-keyword">typeof</span> D===<span class="hljs-string">"number"</span>?D:C}))});<span class="hljs-keyword">return</span>(!x)?z.join(<span class="hljs-string">""</span>):z});r.extend(<span class="hljs-string">"each"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,x);<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>});r.extend(<span class="hljs-string">"map"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">var</span> y=[];o.call(<span class="hljs-keyword">this</span>);c(<span class="hljs-keyword">this</span>.context().results,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z</span>)</span>{y.push(x(z))});<span class="hljs-keyword">return</span> y});T=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">F</span>)</span>{<span class="hljs-keyword">var</span> C=[],G={},D=<span class="hljs-number">1</span>,z={template:<span class="hljs-literal">false</span>,onInsert:<span class="hljs-literal">false</span>,onUpdate:<span class="hljs-literal">false</span>,onRemove:<span class="hljs-literal">false</span>,onDBChange:<span class="hljs-literal">false</span>,storageName:<span class="hljs-literal">false</span>,forcePropertyCase:<span class="hljs-literal">null</span>,cacheSize:<span class="hljs-number">100</span>,name:<span class="hljs-string">""</span>},B=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),A=<span class="hljs-number">0</span>,y=<span class="hljs-number">0</span>,I={},E,x,H;x=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">var</span> K=[],J=<span class="hljs-literal">false</span>;<span class="hljs-keyword">if</span>(L.length===<span class="hljs-number">0</span>){<span class="hljs-keyword">return</span> C}c(L,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">M</span>)</span>{<span class="hljs-keyword">if</span>(T.isString(M)&amp;&amp;<span class="hljs-regexp">/[t][0-9]*[r][0-9]*/i</span>.test(M)&amp;&amp;C[G[M]]){K.push(C[G[M]]);J=<span class="hljs-literal">true</span>}<span class="hljs-keyword">if</span>(T.isObject(M)&amp;&amp;M.___id&amp;&amp;M.___s&amp;&amp;C[G[M.___id]]){K.push(C[G[M.___id]]);J=<span class="hljs-literal">true</span>}<span class="hljs-keyword">if</span>(T.isArray(M)){c(M,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">N</span>)</span>{c(x(N),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">O</span>)</span>{K.push(O)})})}});<span class="hljs-keyword">if</span>(J&amp;&amp;K.length&gt;<span class="hljs-number">1</span>){K=[]}<span class="hljs-keyword">return</span> K};E={dm:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J</span>)</span>{<span class="hljs-keyword">if</span>(J){B=J;I={};A=<span class="hljs-number">0</span>;y=<span class="hljs-number">0</span>}<span class="hljs-keyword">if</span>(z.onDBChange){setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{z.onDBChange.call(C)},<span class="hljs-number">0</span>)}<span class="hljs-keyword">if</span>(z.storageName){setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{localStorage.setItem(<span class="hljs-string">"taffy_"</span>+z.storageName,<span class="hljs-built_in">JSON</span>.stringify(C))})}<span class="hljs-keyword">return</span> B},insert:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">M,N</span>)</span>{<span class="hljs-keyword">var</span> L=[],K=[],J=e(M);c(J,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">P,Q</span>)</span>{<span class="hljs-keyword">var</span> O,R;<span class="hljs-keyword">if</span>(T.isArray(P)&amp;&amp;Q===<span class="hljs-number">0</span>){c(P,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">S</span>)</span>{L.push((z.forcePropertyCase===<span class="hljs-string">"lower"</span>)?S.toLowerCase():(z.forcePropertyCase===<span class="hljs-string">"upper"</span>)?S.toUpperCase():S)});<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isArray(P)){O={};c(P,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">U,S</span>)</span>{O[L[S]]=U});P=O}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isObject(P)&amp;&amp;z.forcePropertyCase){R={};u(P,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">U,S</span>)</span>{R[(z.forcePropertyCase===<span class="hljs-string">"lower"</span>)?S.toLowerCase():(z.forcePropertyCase===<span class="hljs-string">"upper"</span>)?S.toUpperCase():S]=P[S]});P=R}}}D++;P.___id=<span class="hljs-string">"T"</span>+<span class="hljs-built_in">String</span>(n+b).slice(-<span class="hljs-number">6</span>)+<span class="hljs-string">"R"</span>+<span class="hljs-built_in">String</span>(n+D).slice(-<span class="hljs-number">6</span>);P.___s=<span class="hljs-literal">true</span>;K.push(P.___id);<span class="hljs-keyword">if</span>(z.template){P=T.mergeObj(z.template,P)}C.push(P);G[P.___id]=C.length-<span class="hljs-number">1</span>;<span class="hljs-keyword">if</span>(z.onInsert&amp;&amp;(N||TAFFY.isUndefined(N))){z.onInsert.call(P)}E.dm(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>())});<span class="hljs-keyword">return</span> H(K)},sort:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J</span>)</span>{C=j(C,J.split(<span class="hljs-string">","</span>));G={};c(C,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L,K</span>)</span>{G[L.___id]=K});E.dm(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>},update:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Q,M,L</span>)</span>{<span class="hljs-keyword">var</span> P={},O,N,J,K;<span class="hljs-keyword">if</span>(z.forcePropertyCase){u(M,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">R,S</span>)</span>{P[(z.forcePropertyCase===<span class="hljs-string">"lower"</span>)?S.toLowerCase():(z.forcePropertyCase===<span class="hljs-string">"upper"</span>)?S.toUpperCase():S]=R});M=P}O=C[G[Q]];N=T.mergeObj(O,M);J={};K=<span class="hljs-literal">false</span>;u(N,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">R,S</span>)</span>{<span class="hljs-keyword">if</span>(TAFFY.isUndefined(O[S])||O[S]!==R){J[S]=R;K=<span class="hljs-literal">true</span>}});<span class="hljs-keyword">if</span>(K){<span class="hljs-keyword">if</span>(z.onUpdate&amp;&amp;(L||TAFFY.isUndefined(L))){z.onUpdate.call(N,C[G[Q]],J)}C[G[Q]]=N;E.dm(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>())}},remove:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J</span>)</span>{C[G[J]].___s=<span class="hljs-literal">false</span>},removeCommit:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">K</span>)</span>{<span class="hljs-keyword">var</span> J;<span class="hljs-keyword">for</span>(J=C.length-<span class="hljs-number">1</span>;J&gt;-<span class="hljs-number">1</span>;J--){<span class="hljs-keyword">if</span>(!C[J].___s){<span class="hljs-keyword">if</span>(z.onRemove&amp;&amp;(K||TAFFY.isUndefined(K))){z.onRemove.call(C[J])}G[C[J].___id]=<span class="hljs-literal">undefined</span>;C.splice(J,<span class="hljs-number">1</span>)}}G={};c(C,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">M,L</span>)</span>{G[M.___id]=L});E.dm(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>())},query:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">var</span> O,P,K,N,M,J;<span class="hljs-keyword">if</span>(z.cacheSize){P=<span class="hljs-string">""</span>;c(L.filterRaw,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Q</span>)</span>{<span class="hljs-keyword">if</span>(T.isFunction(Q)){P=<span class="hljs-string">"nocache"</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">if</span>(P===<span class="hljs-string">""</span>){P=a(T.mergeObj(L,{q:<span class="hljs-literal">false</span>,run:<span class="hljs-literal">false</span>,sort:<span class="hljs-literal">false</span>}))}}<span class="hljs-keyword">if</span>(!L.results||!L.run||(L.run&amp;&amp;E.dm()&gt;L.run)){K=[];<span class="hljs-keyword">if</span>(z.cacheSize&amp;&amp;I[P]){I[P].i=A++;<span class="hljs-keyword">return</span> I[P].results}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(L.q.length===<span class="hljs-number">0</span>&amp;&amp;L.index.length===<span class="hljs-number">0</span>){c(C,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Q</span>)</span>{K.push(Q)});O=K}<span class="hljs-keyword">else</span>{N=x(L.index);c(N,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Q</span>)</span>{<span class="hljs-keyword">if</span>(L.q.length===<span class="hljs-number">0</span>||h(Q,L.q)){K.push(Q)}});O=K}}}<span class="hljs-keyword">else</span>{O=L.results}<span class="hljs-keyword">if</span>(L.order.length&gt;<span class="hljs-number">0</span>&amp;&amp;(!L.run||!L.sort)){O=j(O,L.order)}<span class="hljs-keyword">if</span>(O.length&amp;&amp;((L.limit&amp;&amp;L.limit&lt;O.length)||L.start)){M=[];c(O,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">R,Q</span>)</span>{<span class="hljs-keyword">if</span>(!L.start||(L.start&amp;&amp;(Q+<span class="hljs-number">1</span>)&gt;=L.start)){<span class="hljs-keyword">if</span>(L.limit){J=(L.start)?(Q+<span class="hljs-number">1</span>)-L.start:Q;<span class="hljs-keyword">if</span>(J&lt;L.limit){M.push(R)}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(J&gt;L.limit){<span class="hljs-keyword">return</span> TAFFY.EXIT}}}<span class="hljs-keyword">else</span>{M.push(R)}}});O=M}<span class="hljs-keyword">if</span>(z.cacheSize&amp;&amp;P!==<span class="hljs-string">"nocache"</span>){y++;setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> Q,R;<span class="hljs-keyword">if</span>(y&gt;=z.cacheSize*<span class="hljs-number">2</span>){y=<span class="hljs-number">0</span>;Q=A-z.cacheSize;R={};u(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">U,S</span>)</span>{<span class="hljs-keyword">if</span>(U.i&gt;=Q){R[S]=U}});I=R}},<span class="hljs-number">0</span>);I[P]={i:A++,results:O}}<span class="hljs-keyword">return</span> O}};H=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> K,J;K=TAFFY.mergeObj(TAFFY.mergeObj(r,{insert:<span class="hljs-literal">undefined</span>}),{getDBI:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">return</span> E},getroot:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">return</span> H.call(L)},context:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">if</span>(L){J=TAFFY.mergeObj(J,L.hasOwnProperty(<span class="hljs-string">"results"</span>)?TAFFY.mergeObj(L,{run:<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),sort:<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()}):L)}<span class="hljs-keyword">return</span> J},extend:<span class="hljs-literal">undefined</span>});J=(<span class="hljs-keyword">this</span>&amp;&amp;<span class="hljs-keyword">this</span>.q)?<span class="hljs-keyword">this</span>:{limit:<span class="hljs-literal">false</span>,start:<span class="hljs-literal">false</span>,q:[],filterRaw:[],index:[],order:[],results:<span class="hljs-literal">false</span>,run:<span class="hljs-literal">null</span>,sort:<span class="hljs-literal">null</span>,settings:z};c(<span class="hljs-built_in">arguments</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">if</span>(w(L)){J.index.push(L)}<span class="hljs-keyword">else</span>{J.q.push(v(L))}J.filterRaw.push(L)});<span class="hljs-keyword">return</span> K};b++;<span class="hljs-keyword">if</span>(F){E.insert(F)}H.insert=E.insert;H.merge=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">M,L,N</span>)</span>{<span class="hljs-keyword">var</span> K={},J=[],O={};N=N||<span class="hljs-literal">false</span>;L=L||<span class="hljs-string">"id"</span>;c(M,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Q</span>)</span>{<span class="hljs-keyword">var</span> P;K[L]=Q[L];J.push(Q[L]);P=H(K).first();<span class="hljs-keyword">if</span>(P){E.update(P.___id,Q,N)}<span class="hljs-keyword">else</span>{E.insert(Q,N)}});O[L]=J;<span class="hljs-keyword">return</span> H(O)};H.TAFFY=<span class="hljs-literal">true</span>;H.sort=E.sort;H.settings=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">J</span>)</span>{<span class="hljs-keyword">if</span>(J){z=TAFFY.mergeObj(z,J);<span class="hljs-keyword">if</span>(J.template){H().update(J.template)}}<span class="hljs-keyword">return</span> z};H.store=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">L</span>)</span>{<span class="hljs-keyword">var</span> K=<span class="hljs-literal">false</span>,J;<span class="hljs-keyword">if</span>(localStorage){<span class="hljs-keyword">if</span>(L){J=localStorage.getItem(<span class="hljs-string">"taffy_"</span>+L);<span class="hljs-keyword">if</span>(J&amp;&amp;J.length&gt;<span class="hljs-number">0</span>){H.insert(J);K=<span class="hljs-literal">true</span>}<span class="hljs-keyword">if</span>(C.length&gt;<span class="hljs-number">0</span>){setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{localStorage.setItem(<span class="hljs-string">"taffy_"</span>+z.storageName,<span class="hljs-built_in">JSON</span>.stringify(C))})}}H.settings({storageName:L})}<span class="hljs-keyword">return</span> H};<span class="hljs-keyword">return</span> H};TAFFY=T;T.each=c;T.eachin=u;T.extend=r.extend;TAFFY.EXIT=<span class="hljs-string">"TAFFYEXIT"</span>;TAFFY.mergeObj=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z,x</span>)</span>{<span class="hljs-keyword">var</span> y={};u(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,B</span>)</span>{y[B]=z[B]});u(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,B</span>)</span>{y[B]=x[B]});<span class="hljs-keyword">return</span> y};TAFFY.has=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">z,y</span>)</span>{<span class="hljs-keyword">var</span> x=<span class="hljs-literal">false</span>,A;<span class="hljs-keyword">if</span>((z.TAFFY)){x=z(y);<span class="hljs-keyword">if</span>(x.length&gt;<span class="hljs-number">0</span>){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>}}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">switch</span>(T.typeOf(z)){<span class="hljs-keyword">case</span><span class="hljs-string">"object"</span>:<span class="hljs-keyword">if</span>(T.isObject(y)){u(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,C</span>)</span>{<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">true</span>&amp;&amp;!T.isUndefined(z[C])&amp;&amp;z.hasOwnProperty(C)){x=T.has(z[C],y[C])}<span class="hljs-keyword">else</span>{x=<span class="hljs-literal">false</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isArray(y)){c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,C</span>)</span>{x=T.has(z,y[C]);<span class="hljs-keyword">if</span>(x){<span class="hljs-keyword">return</span> TAFFY.EXIT}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isString(y)){<span class="hljs-keyword">if</span>(!TAFFY.isUndefined(z[y])){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>}}}}<span class="hljs-keyword">return</span> x;<span class="hljs-keyword">case</span><span class="hljs-string">"array"</span>:<span class="hljs-keyword">if</span>(T.isObject(y)){c(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,C</span>)</span>{x=T.has(z[C],y);<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">true</span>){<span class="hljs-keyword">return</span> TAFFY.EXIT}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isArray(y)){c(y,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">C,B</span>)</span>{c(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">E,D</span>)</span>{x=T.has(z[D],y[B]);<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">true</span>){<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">true</span>){<span class="hljs-keyword">return</span> TAFFY.EXIT}})}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">if</span>(T.isString(y)||T.isNumber(y)){x=<span class="hljs-literal">false</span>;<span class="hljs-keyword">for</span>(A=<span class="hljs-number">0</span>;A&lt;z.length;A++){x=T.has(z[A],y);<span class="hljs-keyword">if</span>(x){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}}}}}<span class="hljs-keyword">return</span> x;<span class="hljs-keyword">case</span><span class="hljs-string">"string"</span>:<span class="hljs-keyword">if</span>(T.isString(y)&amp;&amp;y===z){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:<span class="hljs-keyword">if</span>(T.typeOf(z)===T.typeOf(y)&amp;&amp;z===y){<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}<span class="hljs-keyword">break</span>}}<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>};TAFFY.hasAll=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,z</span>)</span>{<span class="hljs-keyword">var</span> y=TAFFY,x;<span class="hljs-keyword">if</span>(y.isArray(z)){x=<span class="hljs-literal">true</span>;c(z,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B</span>)</span>{x=y.has(A,B);<span class="hljs-keyword">if</span>(x===<span class="hljs-literal">false</span>){<span class="hljs-keyword">return</span> TAFFY.EXIT}});<span class="hljs-keyword">return</span> x}<span class="hljs-keyword">else</span>{<span class="hljs-keyword">return</span> y.has(A,z)}};TAFFY.typeOf=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">var</span> y=<span class="hljs-keyword">typeof</span> x;<span class="hljs-keyword">if</span>(y===<span class="hljs-string">"object"</span>){<span class="hljs-keyword">if</span>(x){<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> x.length===<span class="hljs-string">"number"</span>&amp;&amp;!(x.propertyIsEnumerable(<span class="hljs-string">"length"</span>))){y=<span class="hljs-string">"array"</span>}}<span class="hljs-keyword">else</span>{y=<span class="hljs-string">"null"</span>}}<span class="hljs-keyword">return</span> y};TAFFY.getObjectKeys=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">var</span> y=[];u(x,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,z</span>)</span>{y.push(z)});y.sort();<span class="hljs-keyword">return</span> y};TAFFY.isSameArray=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y,x</span>)</span>{<span class="hljs-keyword">return</span>(TAFFY.isArray(y)&amp;&amp;TAFFY.isArray(x)&amp;&amp;y.join(<span class="hljs-string">","</span>)===x.join(<span class="hljs-string">","</span>))?<span class="hljs-literal">true</span>:<span class="hljs-literal">false</span>};TAFFY.isSameObject=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">A,y</span>)</span>{<span class="hljs-keyword">var</span> x=TAFFY,z=<span class="hljs-literal">true</span>;<span class="hljs-keyword">if</span>(x.isObject(A)&amp;&amp;x.isObject(y)){<span class="hljs-keyword">if</span>(x.isSameArray(x.getObjectKeys(A),x.getObjectKeys(y))){u(A,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">B,C</span>)</span>{<span class="hljs-keyword">if</span>(!((x.isObject(A[C])&amp;&amp;x.isObject(y[C])&amp;&amp;x.isSameObject(A[C],y[C]))||(x.isArray(A[C])&amp;&amp;x.isArray(y[C])&amp;&amp;x.isSameArray(A[C],y[C]))||(A[C]===y[C]))){z=<span class="hljs-literal">false</span>;<span class="hljs-keyword">return</span> TAFFY.EXIT}})}<span class="hljs-keyword">else</span>{z=<span class="hljs-literal">false</span>}}<span class="hljs-keyword">else</span>{z=<span class="hljs-literal">false</span>}<span class="hljs-keyword">return</span> z};f=[<span class="hljs-string">"String"</span>,<span class="hljs-string">"Number"</span>,<span class="hljs-string">"Object"</span>,<span class="hljs-string">"Array"</span>,<span class="hljs-string">"Boolean"</span>,<span class="hljs-string">"Null"</span>,<span class="hljs-string">"Function"</span>,<span class="hljs-string">"Undefined"</span>];q=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>)</span>{<span class="hljs-keyword">return</span> TAFFY.typeOf(y)===x.toLowerCase()?<span class="hljs-literal">true</span>:<span class="hljs-literal">false</span>}};<span class="hljs-keyword">for</span>(p=<span class="hljs-number">0</span>;p&lt;f.length;p++){t=f[p];TAFFY[<span class="hljs-string">"is"</span>+t]=q(t)}}}());<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span>(exports)===<span class="hljs-string">"object"</span>){exports.taffy=TAFFY};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
