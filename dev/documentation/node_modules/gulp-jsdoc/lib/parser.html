<!DOCTYPE html>

<html>
<head>
  <title>parser.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>parser.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @file Parser
 *
 * @summary This is a wrapper around jsdoc parsing infrastructure that generates doc description
 *
 * @version ${ pkg.version }
 * @author ${ pkg.author.name }
 *
 * @license ${ pkg.license }.
 * @copyright ${ pkg.author.name }
 * @name parser.js
 * @unknownTag tag
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
<span class="hljs-pi">  'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Dependencies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> augment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/augment'</span>);
  <span class="hljs-keyword">var</span> borrow = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/borrow'</span>);
  <span class="hljs-keyword">var</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/src/parser'</span>);

  <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

  <span class="hljs-keyword">var</span> Parser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">infs</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Start by resolving defaults for the infos object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    infs = infs || {};

    <span class="hljs-keyword">var</span> informations = {
      name: <span class="hljs-string">''</span>,
      kind: <span class="hljs-string">'package'</span>,
      longname: <span class="hljs-string">''</span>,
      description: <span class="hljs-string">''</span>,
      version: <span class="hljs-string">''</span>,
      licenses: [],
      tags: {
        allowUnknownTags: <span class="hljs-literal">true</span>
      },
      plugins: <span class="hljs-literal">false</span>
    };

    <span class="hljs-built_in">Object</span>.keys(informations).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>)</span>{
      <span class="hljs-keyword">if</span>(key <span class="hljs-keyword">in</span> infs)
        informations[key] = infs[key];
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Validator XXX</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    global.env.conf = global.env.conf || {};
    global.env.conf.tags = informations.tags;
    global.app = {
      jsdoc: {
        name: <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/name'</span>)
      }
    };

    <span class="hljs-keyword">if</span>(!informations.longname)
      informations.longname = informations.kind + <span class="hljs-string">':'</span> + informations.name;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create actual jsdoc parser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> innerParser = <span class="hljs-keyword">new</span> parser.Parser();

    <span class="hljs-keyword">if</span> (informations.plugins) {
      <span class="hljs-keyword">var</span> plugins = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/plugins'</span>);
      informations.plugins = informations.plugins.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{
        <span class="hljs-keyword">return</span> path.resolve(path.join(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'node_modules'</span>, <span class="hljs-string">'jsdoc'</span>), item);
      });
      plugins.installPlugins(informations.plugins, innerParser);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Attach handles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> handlers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsdoc/lib/jsdoc/src/handlers'</span>);
    handlers.attachTo(innerParser);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Set file list up</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> parsedFiles = informations.files = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Do parse</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.parse = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">vinyl</span>)</span>{
      <span class="hljs-keyword">var</span> data = vinyl.contents.toString(<span class="hljs-string">'utf8'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Donâ€™t treat empty files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (data.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>XXX butt-ugly hack - see #5 and 3.3.0-alpha5 release of jsdoc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        env.sourceFiles = [vinyl.base];
        innerParser._parseSourceCode(data, vinyl.path);
        parsedFiles.push(vinyl.path);
      }
    };

    <span class="hljs-keyword">this</span>.complete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Get buffer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> buf = innerParser._resultBuffer;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Push generic package infos</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      buf.push(informations);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Borrow and augment shit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      borrow.indexAll(buf);
      augment.addInherited(buf);
      borrow.resolveBorrows(buf);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Return buf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> buf;
    };
  };

  <span class="hljs-built_in">module</span>.exports = Parser;

}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
