<!DOCTYPE html>

<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*jshint node:true */</span>
<span class="hljs-pi">
"use strict"</span>;

<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> events = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>);
<span class="hljs-keyword">var</span> EventEmitter = events.EventEmitter;
<span class="hljs-keyword">var</span> runTask = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/runTask'</span>);

<span class="hljs-keyword">var</span> Orchestrator = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	EventEmitter.call(<span class="hljs-keyword">this</span>);
	<span class="hljs-keyword">this</span>.doneCallback = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// call this when all tasks in the queue are done</span>
	<span class="hljs-keyword">this</span>.seq = []; <span class="hljs-comment">// the order to run the tasks</span>
	<span class="hljs-keyword">this</span>.tasks = {}; <span class="hljs-comment">// task objects: name, dep (list of names of dependencies), fn (the task to run)</span>
	<span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">false</span>; <span class="hljs-comment">// is the orchestrator running tasks? .start() to start, .stop() to stop</span>
};
util.inherits(Orchestrator, EventEmitter);

	Orchestrator.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRunning) {
			<span class="hljs-keyword">this</span>.stop(<span class="hljs-literal">null</span>);
		}
		<span class="hljs-keyword">this</span>.tasks = {};
		<span class="hljs-keyword">this</span>.seq = [];
		<span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">false</span>;
		<span class="hljs-keyword">this</span>.doneCallback = <span class="hljs-literal">undefined</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	Orchestrator.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, dep, fn</span>) </span>{
		<span class="hljs-keyword">if</span> (!fn &amp;&amp; <span class="hljs-keyword">typeof</span> dep === <span class="hljs-string">'function'</span>) {
			fn = dep;
			dep = <span class="hljs-literal">undefined</span>;
		}
		dep = dep || [];
		fn = fn || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{}; <span class="hljs-comment">// no-op</span>
		<span class="hljs-keyword">if</span> (!name) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Task requires a name'</span>);
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>validate name is a string, dep is an array of strings, and fn is a function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> name !== <span class="hljs-string">'string'</span>) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Task requires a name that is a string'</span>);
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Task '</span>+name+<span class="hljs-string">' requires a function that is a function'</span>);
		}
		<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(dep)) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Task '</span>+name+<span class="hljs-string">' can\'t support dependencies that is not an array of strings'</span>);
		}
		dep.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> item !== <span class="hljs-string">'string'</span>) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Task '</span>+name+<span class="hljs-string">' dependency '</span>+item+<span class="hljs-string">' is not a string'</span>);
			}
		});
		<span class="hljs-keyword">this</span>.tasks[name] = {
			fn: fn,
			dep: dep,
			name: name
		};
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	Orchestrator.prototype.task = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, dep, fn</span>) </span>{
		<span class="hljs-keyword">if</span> (dep || fn) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>alias for add, return nothing rather than this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.add(name, dep, fn);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tasks[name];
		}
	};
	Orchestrator.prototype.hasTask = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
		<span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>.tasks[name];
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>tasks and optionally a callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	Orchestrator.prototype.start = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> args, arg, names = [], lastTask, i, seq = [];
		args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>);
		<span class="hljs-keyword">if</span> (args.length) {
			lastTask = args[args.length-<span class="hljs-number">1</span>];
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> lastTask === <span class="hljs-string">'function'</span>) {
				<span class="hljs-keyword">this</span>.doneCallback = lastTask;
				args.pop();
			}
			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; args.length; i++) {
				arg = args[i];
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'string'</span>) {
					names.push(arg);
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arg)) {
					names = names.concat(arg); <span class="hljs-comment">// FRAGILE: ASSUME: it's an array of strings</span>
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'pass strings or arrays of strings'</span>);
				}
			}
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRunning) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>reset specified tasks (and dependencies) as not run</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>._resetSpecificTasks(names);
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>reset all tasks as not run</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>._resetAllTasks();
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRunning) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>if you call start() again while a previous run is still in play
prepend the new tasks to the existing task queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			names = names.concat(<span class="hljs-keyword">this</span>.seq);
		}
		<span class="hljs-keyword">if</span> (names.length &lt; <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>run all tasks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.tasks) {
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tasks.hasOwnProperty(i)) {
					names.push(<span class="hljs-keyword">this</span>.tasks[i].name);
				}
			}
		}
		seq = [];
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">this</span>.sequence(<span class="hljs-keyword">this</span>.tasks, names, seq, []);
		} <span class="hljs-keyword">catch</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Is this a known error?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (err) {
				<span class="hljs-keyword">if</span> (err.missingTask) {
					<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'task_not_found'</span>, {message: err.message, task:err.missingTask, err: err});
				}
				<span class="hljs-keyword">if</span> (err.recursiveTasks) {
					<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'task_recursion'</span>, {message: err.message, recursiveTasks:err.recursiveTasks, err: err});
				}
			}
			<span class="hljs-keyword">this</span>.stop(err);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
		}
		<span class="hljs-keyword">this</span>.seq = seq;
		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'start'</span>, {message:<span class="hljs-string">'seq: '</span>+<span class="hljs-keyword">this</span>.seq.join(<span class="hljs-string">','</span>)});
		<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRunning) {
			<span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">true</span>;
		}
		<span class="hljs-keyword">this</span>._runStep();
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};
	Orchestrator.prototype.stop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, successfulFinish</span>) </span>{
		<span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">false</span>;
		<span class="hljs-keyword">if</span> (err) {
			<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'err'</span>, {message:<span class="hljs-string">'orchestration failed'</span>, err:err});
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (successfulFinish) {
			<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'stop'</span>, {message:<span class="hljs-string">'orchestration succeeded'</span>});
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>ASSUME</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			err = <span class="hljs-string">'orchestration aborted'</span>;
			<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'err'</span>, {message:<span class="hljs-string">'orchestration aborted'</span>, err: err});
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.doneCallback) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Avoid calling it multiple times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.doneCallback(err);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err &amp;&amp; !<span class="hljs-keyword">this</span>.listeners(<span class="hljs-string">'err'</span>).length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>No one is listening for the error so speak louder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">throw</span> err;
		}
	};
	Orchestrator.prototype.sequence = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequencify'</span>);
	Orchestrator.prototype.allDone = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> i, task, allDone = <span class="hljs-literal">true</span>; <span class="hljs-comment">// nothing disputed it yet</span>
		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.seq.length; i++) {
			task = <span class="hljs-keyword">this</span>.tasks[<span class="hljs-keyword">this</span>.seq[i]];
			<span class="hljs-keyword">if</span> (!task.done) {
				allDone = <span class="hljs-literal">false</span>;
				<span class="hljs-keyword">break</span>;
			}
		}
		<span class="hljs-keyword">return</span> allDone;
	};
	Orchestrator.prototype._resetTask = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">task</span>) </span>{
		<span class="hljs-keyword">if</span> (task) {
			<span class="hljs-keyword">if</span> (task.done) {
				task.done = <span class="hljs-literal">false</span>;
			}
			<span class="hljs-keyword">delete</span> task.start;
			<span class="hljs-keyword">delete</span> task.stop;
			<span class="hljs-keyword">delete</span> task.duration;
			<span class="hljs-keyword">delete</span> task.hrDuration;
			<span class="hljs-keyword">delete</span> task.args;
		}
	};
	Orchestrator.prototype._resetAllTasks = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> task;
		<span class="hljs-keyword">for</span> (task <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.tasks) {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tasks.hasOwnProperty(task)) {
				<span class="hljs-keyword">this</span>._resetTask(<span class="hljs-keyword">this</span>.tasks[task]);
			}
		}
	};
	Orchestrator.prototype._resetSpecificTasks = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">names</span>) </span>{
		<span class="hljs-keyword">var</span> i, name, t;

		<span class="hljs-keyword">if</span> (names &amp;&amp; names.length) {
			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; names.length; i++) {
				name = names[i];
				t = <span class="hljs-keyword">this</span>.tasks[name];
				<span class="hljs-keyword">if</span> (t) {
					<span class="hljs-keyword">this</span>._resetTask(t);
					<span class="hljs-keyword">if</span> (t.dep &amp;&amp; t.dep.length) {
						<span class="hljs-keyword">this</span>._resetSpecificTasks(t.dep); <span class="hljs-comment">// recurse</span>
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>} else {
FRAGILE: ignore that the task doesn’t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				}
			}
		}
	};
	Orchestrator.prototype._runStep = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> i, task;
		<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRunning) {
			<span class="hljs-keyword">return</span>; <span class="hljs-comment">// user aborted, ASSUME: stop called previously</span>
		}
		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.seq.length; i++) {
			task = <span class="hljs-keyword">this</span>.tasks[<span class="hljs-keyword">this</span>.seq[i]];
			<span class="hljs-keyword">if</span> (!task.done &amp;&amp; !task.running &amp;&amp; <span class="hljs-keyword">this</span>._readyToRunTask(task)) {
				<span class="hljs-keyword">this</span>._runTask(task);
			}
			<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRunning) {
				<span class="hljs-keyword">return</span>; <span class="hljs-comment">// task failed or user aborted, ASSUME: stop called previously</span>
			}
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.allDone()) {
			<span class="hljs-keyword">this</span>.stop(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
		}
	};
	Orchestrator.prototype._readyToRunTask = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">task</span>) </span>{
		<span class="hljs-keyword">var</span> ready = <span class="hljs-literal">true</span>, <span class="hljs-comment">// no one disproved it yet</span>
			i, name, t;
		<span class="hljs-keyword">if</span> (task.dep.length) {
			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; task.dep.length; i++) {
				name = task.dep[i];
				t = <span class="hljs-keyword">this</span>.tasks[name];
				<span class="hljs-keyword">if</span> (!t) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>FRAGILE: this should never happen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>.stop(<span class="hljs-string">"can't run "</span>+task.name+<span class="hljs-string">" because it depends on "</span>+name+<span class="hljs-string">" which doesn't exist"</span>);
					ready = <span class="hljs-literal">false</span>;
					<span class="hljs-keyword">break</span>;
				}
				<span class="hljs-keyword">if</span> (!t.done) {
					ready = <span class="hljs-literal">false</span>;
					<span class="hljs-keyword">break</span>;
				}
			}
		}
		<span class="hljs-keyword">return</span> ready;
	};
	Orchestrator.prototype._stopTask = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">task, meta</span>) </span>{
		task.duration = meta.duration;
		task.hrDuration = meta.hrDuration;
		task.running = <span class="hljs-literal">false</span>;
		task.done = <span class="hljs-literal">true</span>;
	};
	Orchestrator.prototype._emitTaskDone = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">task, message, err</span>) </span>{
		<span class="hljs-keyword">if</span> (!task.args) {
			task.args = {task:task.name};
		}
		task.args.duration = task.duration;
		task.args.hrDuration = task.hrDuration;
		task.args.message = task.name+<span class="hljs-string">' '</span>+message;
		<span class="hljs-keyword">var</span> evt = <span class="hljs-string">'stop'</span>;
		<span class="hljs-keyword">if</span> (err) {
			task.args.err = err;
			evt = <span class="hljs-string">'err'</span>;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>‘task_stop’ or ‘task_err’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'task_'</span>+evt, task.args);
	};
	Orchestrator.prototype._runTask = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">task</span>) </span>{
		<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

		task.args = {task:task.name, message:task.name+<span class="hljs-string">' started'</span>};
		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'task_start'</span>, task.args);
		task.running = <span class="hljs-literal">true</span>;

		runTask(task.fn.bind(<span class="hljs-keyword">this</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, meta</span>) </span>{
			that._stopTask.call(that, task, meta);
			that._emitTaskDone.call(that, task, meta.runMethod, err);
			<span class="hljs-keyword">if</span> (err) {
				<span class="hljs-keyword">return</span> that.stop.call(that, err);
			}
			that._runStep.call(that);
		});
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>FRAGILE: ASSUME: this list is an exhaustive list of events emitted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> events = [<span class="hljs-string">'start'</span>,<span class="hljs-string">'stop'</span>,<span class="hljs-string">'err'</span>,<span class="hljs-string">'task_start'</span>,<span class="hljs-string">'task_stop'</span>,<span class="hljs-string">'task_err'</span>,<span class="hljs-string">'task_not_found'</span>,<span class="hljs-string">'task_recursion'</span>];

<span class="hljs-keyword">var</span> listenToEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, event, callback</span>) </span>{
	target.on(event, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
		e.src = event;
		callback(e);
	});
};

	Orchestrator.prototype.onAll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
		<span class="hljs-keyword">var</span> i;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">'function'</span>) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No callback specified'</span>);
		}

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; events.length; i++) {
			listenToEvent(<span class="hljs-keyword">this</span>, events[i], callback);
		}
	};

<span class="hljs-built_in">module</span>.exports = Orchestrator;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
